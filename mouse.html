<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mouse Practices</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- HEADER -->
  <header class="bg-blue-600 text-white shadow-md">
    <div class="container mx-auto flex items-center justify-between px-4 py-4">
      <!-- Home Button -->
      <a href="index.html" class="bg-white text-blue-600 px-3 py-1 rounded-lg font-semibold shadow hover:bg-gray-200">
        Home
      </a>
      <!-- Page Title -->
      <h1 class="text-xl font-bold text-center flex-1">Smartkids Mouse Practices</h1>
      <div class="w-16"></div> <!-- Spacer to balance -->
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="container mx-auto mt-6 px-4">
    <div id="mouseContainer" class="space-y-4"></div>
  </main>

  <!-- MODAL -->
  <div id="mouseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-lg w-11/12 max-w-md p-6 relative">
      <button id="closeModal" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 text-2xl font-bold">&times;</button>
      <h2 id="modalTitle" class="text-xl font-bold mb-4 text-gray-900"></h2>
      <p id="modalInstruction" class="text-gray-700 mb-4"></p>
      <div id="modalContent" class="space-y-2"></div>
      <div class="mt-6 text-right">
        <button id="prevBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">Previous</button>
        <button id="nextBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Next</button>
      </div>
    </div>
  </div>

  <script>
    const container = document.getElementById("mouseContainer");
    const modal = document.getElementById("mouseModal");
    const closeModal = document.getElementById("closeModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalInstruction = document.getElementById("modalInstruction");
    const modalContent = document.getElementById("modalContent");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    let currentTopics = [];
    let currentIndex = 0;

    // Load topic into modal
    function loadMouseTopic(btn) {
      const title = btn.getAttribute("data-title");
      const instruction = btn.getAttribute("data-instruction") || "";
      const samples = btn.getAttribute("data-sample");

      modalTitle.textContent = title;
      modalInstruction.textContent = instruction;
      modalContent.innerHTML = "";

      if (samples) {
        const items = samples.split(",");
        items.forEach(s => {
          const button = document.createElement("button");
          button.textContent = s.trim();
          button.className =
            "block w-full px-4 py-2 rounded-lg shadow text-gray-900 bg-gray-200 hover:bg-blue-50 transition";
          button.addEventListener("click", () => {
            button.style.border = "2px solid blue";
            setTimeout(() => (button.style.border = ""), 300);
          });
          modalContent.appendChild(button);
        });
      }

      modal.classList.remove("hidden");
    }

    // Modal controls
    closeModal.addEventListener("click", () => modal.classList.add("hidden"));
    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        loadMouseTopic(currentTopics[currentIndex]);
      }
    });
    nextBtn.addEventListener("click", () => {
      if (currentIndex < currentTopics.length - 1) {
        currentIndex++;
        loadMouseTopic(currentTopics[currentIndex]);
      }
    });

    // Fetch JSON
    async function loadMouseData() {
      try {
        const res = await fetch("data/mouse.json");
        const data = await res.json();

        // Normalize years
        const years = Array.isArray(data.years) ? data.years : [data.years];

        years.forEach(year => {
          const topics = Array.isArray(year.topics) ? year.topics : [year.topics];

          const card = document.createElement("div");
          card.className = "bg-white rounded-xl shadow-md overflow-hidden";

          const header = document.createElement("button");
          header.className =
            "accordion-header w-full flex justify-between items-center px-6 py-4 text-lg font-semibold bg-blue-100 hover:bg-blue-200 transition";
          header.innerHTML = `<span class="text-gray-900">${year.name}</span><span class="text-gray-900">+</span>`;
          card.appendChild(header);

          const body = document.createElement("div");
          body.className = "accordion-body bg-gray-50 overflow-hidden transition-all duration-300 max-h-0";

          const listWrapper = document.createElement("ul");
          listWrapper.className = "space-y-2 pl-6";

          topics.forEach(topic => {
            const li = document.createElement("li");
            li.innerHTML = `
              <button class="topicBtn block w-full text-left px-4 py-2 rounded-lg shadow text-gray-900 bg-white hover:bg-blue-50 transition flex items-center gap-2"
                data-title="${topic.title}"
                data-instruction="${topic.instruction || ""}"
                data-sample="${topic.sample}">
                üñ±Ô∏è ${topic.title}
              </button>`;
            listWrapper.appendChild(li);
          });

          body.appendChild(listWrapper);
          card.appendChild(body);

          // Accordion toggle
          header.addEventListener("click", () => {
            const isOpen = body.style.maxHeight && body.style.maxHeight !== "0px";
            container.querySelectorAll(".accordion-body").forEach(
              el => (el.style.maxHeight = null)
            );
            container
              .querySelectorAll(".accordion-header span:last-child")
              .forEach(icon => (icon.textContent = "+"));
            if (!isOpen) {
              body.style.maxHeight = body.scrollHeight + "px";
              header.querySelector("span:last-child").textContent = "‚àí";
            }
          });

          container.appendChild(card);
        });

        // Handle topic button clicks
        container.addEventListener("click", e => {
          const btn = e.target.closest(".topicBtn");
          if (!btn) return;
          currentTopics = [...btn.closest("ul").querySelectorAll(".topicBtn")];
          currentIndex = currentTopics.indexOf(btn);
          loadMouseTopic(btn);
        });
      } catch (err) {
        console.error("Error loading JSON:", err);
        container.innerHTML =
          '<p class="text-red-500">‚ö†Ô∏è Failed to load mouse data. Make sure <code>data/mouse.json</code> exists.</p>';
      }
    }

    loadMouseData();
  </script>
</body>
</html>
