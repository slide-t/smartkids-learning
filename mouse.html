<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Mouse Practice</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-purple-100 text-gray-900 font-sans min-h-screen flex flex-col items-center justify-center">

  <!-- Header -->
  <header class="bg-purple-600 text-white shadow-md fixed top-0 left-0 w-full z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl font-bold">üñ±Ô∏è Mouse Practice</h1>
      <a href="classes.html" class="bg-white text-purple-600 px-4 py-2 rounded-lg font-medium shadow hover:bg-purple-100 transition">
        Back to Classes
      </a>
    </div>
  </header>

  <!-- Main Game Container -->
  <main class="flex-1 w-full max-w-4xl mx-auto px-4 pt-24 flex flex-col items-center justify-center">
    <div id="game-container" class="bg-white rounded-2xl shadow-lg p-6 w-full min-h-[300px] flex flex-col items-center justify-center relative">
      <div id="question-container" class="text-2xl font-bold text-center mb-4">Loading Mouse Activity...</div>
      <div id="feedback" class="text-lg font-semibold text-center text-gray-700 mb-4"></div>
      <button id="next-btn" class="hidden px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg shadow hover:bg-purple-700 transition">
        Next
      </button>
    </div>
  </main>

  <!-- Inline Script (merged mouse.js) -->
  <script>
    // Get topic & year from URL parameters or default values
    const urlParams = new URLSearchParams(window.location.search);
    const topicParam = urlParams.get("topic") || "Mouse Practice";
    const yearParam = parseInt(urlParams.get("year")) || 1;

    const questionContainer = document.getElementById("question-container");
    const feedback = document.getElementById("feedback");
    const nextBtn = document.getElementById("next-btn");
    const gameContainer = document.getElementById("game-container");

    let topics = [];
    let currentTopicIndex = 0;

    // Load mouse.json
    async function loadMouseData(year) {
      try {
        const res = await fetch("mouse.json");
        const data = await res.json();
        const yearData = data.find(y => y.year === year);
        if (yearData) {
          topics = yearData.topics;
          loadTopic(currentTopicIndex);
        } else {
          questionContainer.textContent = "‚ö†Ô∏è No topics found for this year.";
        }
      } catch (err) {
        console.error("Failed to load mouse.json:", err);
        questionContainer.textContent = "‚ö†Ô∏è Could not load practice data.";
      }
    }

    // Load a topic
    function loadTopic(index) {
      const topic = topics[index];
      if (!topic) return;

      questionContainer.textContent = topic.description;
      feedback.textContent = "";

      // Clear previous UI
      [...gameContainer.querySelectorAll(".practice-item")].forEach(el => el.remove());

      if (topic.type === "click") {
        spawnClickable(topic);
      } else if (topic.type === "double-click") {
        spawnDoubleClick(topic);
      } else if (topic.type === "drag") {
        spawnDragDrop(topic);
      } else {
        feedback.textContent = "üöß This practice type not yet implemented.";
      }

      // Show Next button if more topics exist
      nextBtn.classList.toggle("hidden", index >= topics.length - 1);
    }

    // Practice Types
    function spawnClickable(topic) {
      const btn = document.createElement("div");
      btn.textContent = topic.emoji || "üñ±Ô∏è";
      btn.className = "practice-item text-4xl cursor-pointer select-none";
      btn.addEventListener("click", () => {
        feedback.textContent = "‚úÖ Good job!";
      });
      gameContainer.appendChild(btn);
    }

    function spawnDoubleClick(topic) {
      const btn = document.createElement("div");
      btn.textContent = topic.emoji || "üñ±Ô∏è";
      btn.className = "practice-item text-4xl cursor-pointer select-none";
      btn.addEventListener("dblclick", () => {
        feedback.textContent = "üéâ Double click success!";
      });
      gameContainer.appendChild(btn);
    }

    function spawnDragDrop(topic) {
      const drag = document.createElement("div");
      drag.textContent = topic.emoji || "üñ±Ô∏è";
      drag.draggable = true;
      drag.className = "practice-item text-4xl cursor-move select-none";

      const target = document.createElement("div");
      target.textContent = topic.target || "üéØ";
      target.className = "practice-item text-4xl border-2 border-dashed border-gray-400 p-4 mt-4";

      drag.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", "dragging");
      });

      target.addEventListener("dragover", e => e.preventDefault());
      target.addEventListener("drop", () => {
        feedback.textContent = "‚úÖ Dropped successfully!";
      });

      gameContainer.appendChild(drag);
      gameContainer.appendChild(target);
    }

    // Next button
    nextBtn.addEventListener("click", () => {
      if (currentTopicIndex < topics.length - 1) {
        currentTopicIndex++;
        loadTopic(currentTopicIndex);
      }
    });

    // Init
    loadMouseData(yearParam);
  </script>
</body>
</html>
