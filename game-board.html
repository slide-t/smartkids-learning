



<script>
// --- your existing constants ---
const practiceArea = document.getElementById('practiceArea');
const scoreDisplay = document.getElementById('scoreDisplay');
const virtualKeyboard = document.getElementById('virtualKeyboard');

let score = 0;
let currentIndex = 0;
let currentLetterIndex = 0;
let currentSequence = []; // will come from JSON dynamically

// keyboard layout
const keyboardRows = [
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L',';'],
  ['Z','X','C','V','B','N','M',',','.','/']
];

// --- NEW: load lessons from JSON ---
async function loadLessons() {
  try {
    const res = await fetch('classes.json'); // your JSON file
    const data = await res.json();

    // Example: pick Year 1 -> Keyboard -> Lesson 1 automatically
    // You can later hook this up to clicks
    const defaultLesson = data['Year 1']?.['Term 1']?.['Keyboard']?.['Lessons']?.[0]?.sample;
    if (defaultLesson && Array.isArray(defaultLesson)) {
      startLesson(defaultLesson);
    }
  } catch (err) {
    console.error('Error loading lessons:', err);
  }
}

// --- Start a lesson with sequence from JSON ---
function startLesson(sequence) {
  score = 0;
  currentIndex = 0;
  currentLetterIndex = 0;
  currentSequence = sequence;
  scoreDisplay.textContent = `Score: ${score}`;
  buildKeyboard();
  showCurrentLetter();
}

// build keyboard UI
function buildKeyboard() {
  virtualKeyboard.innerHTML = '';
  keyboardRows.forEach(row=>{
    const rowDiv = document.createElement('div');
    rowDiv.classList.add('keyboard-row');
    row.forEach(key=>{
      const keyDiv = document.createElement('div');
      keyDiv.classList.add('vk-key');
      keyDiv.textContent = key;
      rowDiv.appendChild(keyDiv);
    });
    virtualKeyboard.appendChild(rowDiv);
  });
}

// highlight keys
function highlightVK(keyChar,type='highlight'){
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{ 
    vk.classList.remove('highlight','correct','wrong'); 
    vk.style.backgroundColor = vk.classList.contains('active') ? '#e7e7e7' : '#ccc';
  });
  const vk = Array.from(vkKeys).find(k=>k.textContent===keyChar);
  if(vk){
    if(type==='correct') vk.style.backgroundColor='#4CAF50';
    if(type==='wrong') vk.style.backgroundColor='#f44336';
    if(type==='highlight') vk.style.backgroundColor='#ffeb3b';
  }
}

// enable only relevant keys
function enableKeysForSequence() {
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{
    vk.classList.remove('active');
    if(currentSequence.some(seq=>seq.includes(vk.textContent))){
      vk.classList.add('active');
      vk.onclick = ()=>handleInput(vk.textContent);
    } else {
      vk.onclick = null;
    }
  });
}

// show current letter/word
function showCurrentLetter(){
  if(currentIndex>=currentSequence.length){
    practiceArea.innerHTML='<p>Well done! Lesson finished.</p>';
    highlightVK('');
    return;
  }
  practiceArea.innerHTML='';
  const keyDiv = document.createElement('div');
  keyDiv.classList.add('key');
  const currentWord = currentSequence[currentIndex];
  keyDiv.textContent = currentWord[currentLetterIndex] || currentWord;
  practiceArea.appendChild(keyDiv);
  enableKeysForSequence();
  highlightVK(keyDiv.textContent,'highlight');
}

// handle input
function handleInput(input){
  if(currentIndex>=currentSequence.length) return;
  const currentWord = currentSequence[currentIndex];
  const expectedLetter = currentWord[currentLetterIndex];
  const keyDiv = document.querySelector('.key');
  if(input.toUpperCase()===expectedLetter.toUpperCase()){
    keyDiv.classList.add('correct');
    highlightVK(expectedLetter,'correct');
    score++;
    currentLetterIndex++;
    if(currentLetterIndex>=currentWord.length){
      currentLetterIndex=0;
      currentIndex++;
      setTimeout(()=>{ keyDiv.classList.add('flip'); showCurrentLetter(); },400);
    } else {
      setTimeout(()=>{ keyDiv.classList.add('flip'); showCurrentLetter(); },400);
    }
  } else {
    keyDiv.classList.add('wrong');
    highlightVK(expectedLetter,'wrong');
    setTimeout(()=>{ keyDiv.classList.add('flip'); showCurrentLetter(); },400);
  }
  scoreDisplay.textContent=`Score: ${score}`;
}

// capture real keyboard
document.addEventListener('keydown', e=>{
  const key = e.key.length===1 ? e.key : '';
  handleInput(key);
});

window.focus();
loadLessons(); // start by loading JSON
</script>
