<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Year 1 Typing Practice - Real Keyboard Layout</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f2f2f2; display:flex; flex-direction:column; align-items:center;}
  header { background:#4CAF50; color:white; padding:1rem; width:100%; text-align:center; }
  .container { max-width:700px; margin-top:20px; padding:1rem; background:white; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.2); text-align:center;}
  .practice-area { min-height:150px; padding:1rem; border:1px solid #ccc; border-radius:5px; background:#fafafa; display:flex; justify-content:center; align-items:center; font-size:3rem; perspective:1000px; margin-bottom:15px;}
  .key { width:60px; height:60px; line-height:60px; margin:0.3rem; text-align:center; border:2px solid #ccc; border-radius:10px; background:#e7e7e7; transform-style:preserve-3d; transition: transform 0.4s, background 0.3s;}
  .key.correct { background:#4CAF50; color:white; }
  .key.wrong { background:#f44336; color:white; }
  .flip { transform: rotateY(90deg); }
  .virtual-keyboard { display:flex; flex-direction:column; justify-content:center; gap:5px; margin-top:15px; }
  .keyboard-row { display:flex; justify-content:center; gap:5px; }
  .vk-key { width:50px; height:50px; line-height:50px; text-align:center; border-radius:5px; background:#ccc; user-select:none; cursor:default; }
  .vk-key.active { cursor:pointer; background:#e7e7e7; }
  .vk-key.highlight { background:#ffeb3b; }
  .score { font-weight:bold; margin-top:10px; }
</style>
</head>
<body>

<header><h1>Year 1 Typing Practice</h1></header>

<div class="container">
  <div class="practice-area" id="practiceArea"></div>
  <div class="score" id="scoreDisplay">Score: 0</div>
  <div class="virtual-keyboard" id="virtualKeyboard"></div>
</div>

<script>
// keyboard.js
document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("keyboard-game");

  // Get topic from query string
  const urlParams = new URLSearchParams(window.location.search);
  const topicId = urlParams.get("topic");

  if (!topicId) {
    container.innerHTML = `<p class="text-red-500">No topic selected.</p>`;
    return;
  }

  // Load topics.json
  fetch("data/topics.json")
    .then((res) => res.json())
    .then((topics) => {
      const topic = topics[topicId];
      if (!topic) {
        container.innerHTML = `<p class="text-red-500">Topic not found.</p>`;
        return;
      }

      container.innerHTML = `
        <h2 class="text-xl font-bold mb-4">${topic.title}</h2>
        <p class="mb-4">${topic.instructions}</p>
        <div id="game-area" class="hidden">
          <p id="prompt" class="text-lg mb-2"></p>
          <input id="input" type="text" class="border p-2 w-full mb-2" placeholder="Type here..." disabled />
          <div id="virtual-keyboard" class="grid grid-cols-10 gap-2 mb-4"></div>
          <p id="feedback" class="mt-2"></p>
        </div>
        <button id="start-btn" class="bg-green-500 text-white px-4 py-2 rounded">Start</button>
        <button id="restart-btn" class="bg-blue-500 text-white px-4 py-2 rounded hidden">Restart</button>
        <button id="back-btn" class="bg-gray-500 text-white px-4 py-2 rounded">Back</button>
        <button id="home-btn" class="bg-gray-700 text-white px-4 py-2 rounded">Home</button>
      `;

      // Select elements
      const startBtn = document.getElementById("start-btn");
      const restartBtn = document.getElementById("restart-btn");
      const backBtn = document.getElementById("back-btn");
      const homeBtn = document.getElementById("home-btn");
      const gameArea = document.getElementById("game-area");
      const prompt = document.getElementById("prompt");
      const input = document.getElementById("input");
      const feedback = document.getElementById("feedback");
      const keyboard = document.getElementById("virtual-keyboard");

      let currentIndex = 0;

      // Generate virtual keyboard keys
      const keys = [
        ..."abcdefghijklmnopqrstuvwxyz",
        "space",
        "backspace"
      ];

      keys.forEach((key) => {
        const keyBtn = document.createElement("button");
        keyBtn.textContent = key === "space" ? "␣" : key === "backspace" ? "⌫" : key;
        keyBtn.className = "bg-gray-300 rounded p-2 text-center";
        keyBtn.addEventListener("click", () => handleVirtualKey(key));
        keyboard.appendChild(keyBtn);
      });

      function handleVirtualKey(key) {
        if (input.disabled) return;
        if (key === "space") {
          input.value += " ";
        } else if (key === "backspace") {
          input.value = input.value.slice(0, -1);
        } else {
          input.value += key;
        }
      }

      function loadPrompt() {
        prompt.textContent = topic.content[currentIndex];
        input.value = "";
        input.focus();
      }

      function startGame() {
        startBtn.classList.add("hidden");
        restartBtn.classList.add("hidden");
        gameArea.classList.remove("hidden");
        input.disabled = false;
        feedback.textContent = "";
        currentIndex = 0;
        loadPrompt();
      }

      function checkInput() {
        if (input.value === topic.content[currentIndex]) {
          feedback.textContent = "✅ Correct!";
          feedback.className = "text-green-600 mt-2";

          currentIndex++;
          if (currentIndex < topic.content.length) {
            setTimeout(loadPrompt, 1000);
          } else {
            feedback.textContent = "🎉 Well done! You finished.";
            feedback.className = "text-blue-600 mt-2";
            input.disabled = true;
            restartBtn.classList.remove("hidden");
          }
        } else {
          feedback.textContent = "❌ Try again.";
          feedback.className = "text-red-600 mt-2";
        }
      }

      // Event Listeners
      startBtn.addEventListener("click", startGame);
      restartBtn.addEventListener("click", startGame);

      input.addEventListener("keyup", (e) => {
        if (e.key === "Enter") {
          checkInput();
        }
      });

      backBtn.addEventListener("click", () => window.history.back());
      homeBtn.addEventListener("click", () => (window.location.href = "index.html"));
    })
    .catch(() => {
      container.innerHTML = `<p class="text-red-500">Error loading topics.</p>`;
    });
});

  /*
const practiceArea = document.getElementById('practiceArea');
const scoreDisplay = document.getElementById('scoreDisplay');
const virtualKeyboard = document.getElementById('virtualKeyboard');

let score = 0;
let currentIndex = 0;
let currentLetterIndex = 0;
let currentSequence = [];
let topicType = "";

// Keyboard layout
const keyboardRows = [
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L',';'],
  ['Z','X','C','V','B','N','M',',','.','/']
];

// Build virtual keyboard
function buildKeyboard() {
  virtualKeyboard.innerHTML = '';
  keyboardRows.forEach(row=>{
    const rowDiv = document.createElement('div');
    rowDiv.classList.add('keyboard-row');
    row.forEach(key=>{
      const keyDiv = document.createElement('div');
      keyDiv.classList.add('vk-key');
      keyDiv.textContent = key;
      rowDiv.appendChild(keyDiv);
    });
    virtualKeyboard.appendChild(rowDiv);
  });
}
buildKeyboard();

// Highlight keys
function highlightVK(keyChar,type='highlight'){
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{ 
    vk.classList.remove('highlight','correct','wrong'); 
    vk.style.backgroundColor = vk.classList.contains('active') ? '#e7e7e7' : '#ccc';
  });
  const vk = Array.from(vkKeys).find(k=>k.textContent.toUpperCase()===keyChar.toUpperCase());
  if(vk){
    vk.classList.add(type);
    if(type==='correct') vk.style.backgroundColor='#4CAF50';
    if(type==='wrong') vk.style.backgroundColor='#f44336';
    if(type==='highlight') vk.style.backgroundColor='#ffeb3b';
  }
}

// Enable clickable keys
function enableKeysForSequence() {
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{
    vk.classList.remove('active');
    if(currentSequence.some(seq => seq.toUpperCase().includes(vk.textContent))){
      vk.classList.add('active');
      vk.onclick = ()=>handleInput(vk.textContent);
    } else {
      vk.onclick = null;
    }
  });
}

// Show current practice letter/word
function showCurrentLetter(){
  if(currentIndex >= currentSequence.length){
    practiceArea.innerHTML='<p>✅ Well done! You finished this topic.</p>';
    highlightVK('');
    return;
  }

  practiceArea.innerHTML='';
  const keyDiv = document.createElement('div');
  keyDiv.classList.add('key');

  const currentWord = currentSequence[currentIndex];
  keyDiv.textContent = currentWord[currentLetterIndex] || currentWord;
  practiceArea.appendChild(keyDiv);

  enableKeysForSequence();
  highlightVK(keyDiv.textContent,'highlight');
}

// Handle input
function handleInput(input){
  if(currentIndex>=currentSequence.length) return;
  const currentWord = currentSequence[currentIndex];
  const expectedLetter = currentWord[currentLetterIndex];
  const keyDiv = document.querySelector('.key');
  if(input.toUpperCase()===expectedLetter.toUpperCase()){
    keyDiv.classList.add('correct');
    highlightVK(expectedLetter,'correct');
    score++;
    currentLetterIndex++;
    if(currentLetterIndex>=currentWord.length){
      currentLetterIndex=0;
      currentIndex++;
      setTimeout(showCurrentLetter,400);
    } else {
      setTimeout(showCurrentLetter,400);
    }
  } else {
    keyDiv.classList.add('wrong');
    highlightVK(expectedLetter,'wrong');
    setTimeout(showCurrentLetter,400);
  }
  scoreDisplay.textContent=`Score: ${score}`;
}

// Listen to real keyboard
document.addEventListener('keydown', e=>{
  const key = e.key.length===1 ? e.key : '';
  handleInput(key);
});

// --- Fetch JSON and load topic ---
async function loadTopic(){
  const urlParams = new URLSearchParams(window.location.search);
  let yearId = urlParams.get('year');      // "1" or "year1"
  const termNum = parseInt(urlParams.get('term'));  // "1"
  const categoryId = urlParams.get('category');     // "keyboard"
  const topicParam = urlParams.get('topic');        // "Home Row Intro"

  console.log("URL Params →", {yearId, termNum, categoryId, topicParam});

  // Normalize yearId → always like "year1"
  if(yearId){
    if(!yearId.startsWith("year")){
      yearId = "year" + yearId;
    }
  }

  if(!yearId){
    practiceArea.innerHTML = "<p>⚠️ Error: No year specified in URL.</p>";
    return;
  }

  try {
    const res = await fetch('data/classes.json');
    if(!res.ok) throw new Error("Cannot load JSON file");
    const data = await res.json();

    const year = data.find(y => y.id === yearId);
    if(!year){
      practiceArea.innerHTML=`<p>❌ Year ${yearId} not found in JSON.</p>`;
      return;
    }

    const term = year.terms.find(t => t.number === termNum);
    if(!term) return practiceArea.innerHTML=`<p>❌ Term ${termNum} not found.</p>`;

    const category = term.categories.find(c => c.id === categoryId);
    if(!category) return practiceArea.innerHTML=`<p>❌ Category "${categoryId}" not found.</p>`;

    const topic = category.topics.find(t => t.title === topicParam);
    if(!topic) return practiceArea.innerHTML=`<p>❌ Topic "${topicParam}" not found.</p>`;

    topicType = topic.type;
    currentSequence = topic.items;
    console.log("✅ Loaded topic:", topic);
    showCurrentLetter();

  } catch(err){
    practiceArea.innerHTML = `<p>⚠️ Error: ${err.message}</p>`;
  }
}

window.focus();
loadTopic();
</script>


  <!--
<script>
const practiceArea = document.getElementById('practiceArea');
const scoreDisplay = document.getElementById('scoreDisplay');
const virtualKeyboard = document.getElementById('virtualKeyboard');

let score = 0;
let currentIndex = 0;
let currentLetterIndex = 0;
let currentSequence = [];
let topicType = "";

// Keyboard layout
const keyboardRows = [
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L',';'],
  ['Z','X','C','V','B','N','M',',','.','/']
];

// Build virtual keyboard
function buildKeyboard() {
  virtualKeyboard.innerHTML = '';
  keyboardRows.forEach(row=>{
    const rowDiv = document.createElement('div');
    rowDiv.classList.add('keyboard-row');
    row.forEach(key=>{
      const keyDiv = document.createElement('div');
      keyDiv.classList.add('vk-key');
      keyDiv.textContent = key;
      rowDiv.appendChild(keyDiv);
    });
    virtualKeyboard.appendChild(rowDiv);
  });
}
buildKeyboard();

// Highlight keys
function highlightVK(keyChar,type='highlight'){
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{ 
    vk.classList.remove('highlight','correct','wrong'); 
    vk.style.backgroundColor = vk.classList.contains('active') ? '#e7e7e7' : '#ccc';
  });
  const vk = Array.from(vkKeys).find(k=>k.textContent.toUpperCase()===keyChar.toUpperCase());
  if(vk){
    vk.classList.add(type);
    if(type==='correct') vk.style.backgroundColor='#4CAF50';
    if(type==='wrong') vk.style.backgroundColor='#f44336';
    if(type==='highlight') vk.style.backgroundColor='#ffeb3b';
  }
}

// Enable clickable keys
function enableKeysForSequence() {
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{
    vk.classList.remove('active');
    if(currentSequence.some(seq => seq.toUpperCase().includes(vk.textContent))){
      vk.classList.add('active');
      vk.onclick = ()=>handleInput(vk.textContent);
    } else {
      vk.onclick = null;
    }
  });
}

// Show current practice letter/word
function showCurrentLetter(){
  if(currentIndex >= currentSequence.length){
    practiceArea.innerHTML='<p>✅ Well done! You finished this topic.</p>';
    highlightVK('');
    return;
  }

  practiceArea.innerHTML='';
  const keyDiv = document.createElement('div');
  keyDiv.classList.add('key');

  const currentWord = currentSequence[currentIndex];
  keyDiv.textContent = currentWord[currentLetterIndex] || currentWord;
  practiceArea.appendChild(keyDiv);

  enableKeysForSequence();
  highlightVK(keyDiv.textContent,'highlight');
}

// Handle input
function handleInput(input){
  if(currentIndex>=currentSequence.length) return;
  const currentWord = currentSequence[currentIndex];
  const expectedLetter = currentWord[currentLetterIndex];
  const keyDiv = document.querySelector('.key');
  if(input.toUpperCase()===expectedLetter.toUpperCase()){
    keyDiv.classList.add('correct');
    highlightVK(expectedLetter,'correct');
    score++;
    currentLetterIndex++;
    if(currentLetterIndex>=currentWord.length){
      currentLetterIndex=0;
      currentIndex++;
      setTimeout(showCurrentLetter,400);
    } else {
      setTimeout(showCurrentLetter,400);
    }
  } else {
    keyDiv.classList.add('wrong');
    highlightVK(expectedLetter,'wrong');
    setTimeout(showCurrentLetter,400);
  }
  scoreDisplay.textContent=`Score: ${score}`;
}

// Listen to real keyboard
document.addEventListener('keydown', e=>{
  const key = e.key.length===1 ? e.key : '';
  handleInput(key);
});

// --- Fetch JSON and load topic ---
async function loadTopic(){
  const urlParams = new URLSearchParams(window.location.search);
  const yearId = urlParams.get('year');      // "1"
  const termNum = parseInt(urlParams.get('term'));  // "1"
  const categoryId = urlParams.get('category'); // "keyboard"
  const topicParam = urlParams.get('topic');   // "Home Row Intro"

  console.log("URL Params →", {yearId, termNum, categoryId, topicParam});

  if(!yearId){
    practiceArea.innerHTML = "<p>⚠️ Error: No year specified in URL.</p>";
    return;
  }

  try {
    const res = await fetch('data/classes.json');
    if(!res.ok) throw new Error("Cannot load JSON file");
    const data = await res.json();

    const yearKey = `year${yearId}`;
    const year = data.find(y => y.id === yearKey);
    if(!year){
      practiceArea.innerHTML=`<p>❌ Year ${yearId} not found in JSON (looking for id="${yearKey}").</p>`;
      return;
    }

    const term = year.terms.find(t => t.number === termNum);
    if(!term) return practiceArea.innerHTML=`<p>❌ Term ${termNum} not found.</p>`;

    const category = term.categories.find(c => c.id === categoryId);
    if(!category) return practiceArea.innerHTML=`<p>❌ Category "${categoryId}" not found.</p>`;

    const topic = category.topics.find(t => t.title === topicParam);
    if(!topic) return practiceArea.innerHTML=`<p>❌ Topic "${topicParam}" not found.</p>`;

    topicType = topic.type;
    currentSequence = topic.items;
    console.log("✅ Loaded topic:", topic);
    showCurrentLetter();

  } catch(err){
    practiceArea.innerHTML = `<p>⚠️ Error: ${err.message}</p>`;
  }
}

window.focus();
loadTopic();
</script>
-->
</body>
</html>
