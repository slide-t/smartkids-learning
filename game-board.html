<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Typing Practice</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; text-align:center; }
    #practiceArea { margin:20px auto; padding:20px; width:80%; min-height:120px; background:#fff; border:2px solid #444; border-radius:10px; }
    #virtualKeyboard { margin-top:20px; }
    .key { display:inline-block; margin:2px; padding:10px 15px; background:#ddd; border-radius:5px; }
    #controls { margin-top:20px; }
    button { margin:5px; padding:10px 20px; border:none; border-radius:5px; background:#444; color:#fff; cursor:pointer; }
    #scoreDisplay, #timerDisplay { margin-top:10px; font-size:18px; }
  </style>
</head>
<body>

  <h1>Typing Practice</h1>

  <div id="practiceArea">Loading...</div>
  <div id="scoreDisplay">Score: 0</div>
  <div id="timerDisplay">Time: 0s</div>

  <div id="virtualKeyboard"></div>

  <div id="controls">
    <button id="prevBtn">Prev</button>
    <button id="nextBtn">Next</button>
    <button id="restartBtn">Restart</button>
  </div>

  <script>
    const practiceArea = document.getElementById('practiceArea');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const timerDisplay = document.getElementById('timerDisplay');
    const virtualKeyboard = document.getElementById('virtualKeyboard');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const restartBtn = document.getElementById('restartBtn');

    let data = null;
    let currentTopicIndex = 0;
    let score = 0;
    let timer = 0, timerInterval = null;

    // build virtual keyboard
    const rows = [
      ["q","w","e","r","t","y","u","i","o","p"],
      ["a","s","d","f","g","h","j","k","l",";"],
      ["z","x","c","v","b","n","m"]
    ];
    function renderKeyboard(){
      virtualKeyboard.innerHTML="";
      rows.forEach(row=>{
        const rowDiv=document.createElement("div");
        row.forEach(k=>{
          const key=document.createElement("div");
          key.className="key";
          key.textContent=k;
          rowDiv.appendChild(key);
        });
        virtualKeyboard.appendChild(rowDiv);
      });
    }

    function startTimer(){
      if(timerInterval) clearInterval(timerInterval);
      timer=0;
      timerDisplay.textContent="Time: 0s";
      timerInterval=setInterval(()=>{
        timer++;
        timerDisplay.textContent="Time: "+timer+"s";
      },1000);
    }

    function loadTopic(index){
      if(!data || !data.classes || data.classes.length===0){
        practiceArea.textContent="No class found.";
        return;
      }
      const cls = data.classes[0];  
      const term = cls.terms[0];    
      const cat = term.categories[0];  
      const topics = cat.topics;
      if(!topics || topics.length===0){
        practiceArea.textContent="No topics found.";
        return;
      }
      if(index<0) index=0;
      if(index>=topics.length) index=topics.length-1;
      currentTopicIndex=index;
      const topic=topics[index];

      practiceArea.textContent="Topic: "+topic.title+" | Practice: "+topic.items.join(" ");
      score=0;
      scoreDisplay.textContent="Score: "+score;
      startTimer();
    }

    // navigation
    prevBtn.onclick=()=> loadTopic(currentTopicIndex-1);
    nextBtn.onclick=()=> loadTopic(currentTopicIndex+1);
    restartBtn.onclick=()=> loadTopic(currentTopicIndex);

    // fetch JSON
    fetch("classes.json")
      .then(r=>r.json())
      .then(json=>{
        data=json;
        loadTopic(0);
      })
      .catch(err=>{
        console.error("Error loading JSON",err);
        practiceArea.textContent="Cannot load classes.json";
      });

    renderKeyboard();
  </script>

</body>
</html>
