<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Typing Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:10px; background:#f9f9f9; }
    h1 { text-align:center; }
    #practiceArea { margin:10px auto; padding:15px; width:95%; min-height:80px; background:#fff; border:2px solid #444; border-radius:10px; }
    #scoreDisplay, #timerDisplay { margin-top:10px; font-size:16px; text-align:center; }
    #virtualKeyboard { margin:15px auto; max-width:700px; }
    .keyRow { display:flex; justify-content:center; margin:3px 0; flex-wrap:wrap; }
    .key {
      flex:0 0 auto;
      margin:2px;
      padding:10px 12px;
      background:#ddd;
      border-radius:5px;
      font-size:14px;
      min-width:28px;
      text-align:center;
      user-select:none;
    }
    .key.active { background:#4CAF50; color:#fff; }
    .key.disabled { opacity:0.3; }
    .spacebar { flex:1; min-width:120px; }
    #controls { margin-top:15px; text-align:center; }
    button { margin:5px; padding:8px 15px; border:none; border-radius:5px; background:#444; color:#fff; cursor:pointer; }
  </style>
</head>
<body>

  <h1>Typing Practice</h1>

  <div id="practiceArea">Loading...</div>
  <div id="scoreDisplay">Score: 0</div>
  <div id="timerDisplay">Time: 0s</div>

  <div id="virtualKeyboard"></div>

  <div id="controls">
    <button id="prevBtn">Prev</button>
    <button id="nextBtn">Next</button>
    <button id="restartBtn">Restart</button>
  </div>

  <script>
    const practiceArea = document.getElementById('practiceArea');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const timerDisplay = document.getElementById('timerDisplay');
    const virtualKeyboard = document.getElementById('virtualKeyboard');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const restartBtn = document.getElementById('restartBtn');

    let data = null;
    let currentTopicIndex = 0;
    let score = 0;
    let timer = 0, timerInterval = null;

    // QWERTY rows with specials
    const rows = [
      ["q","w","e","r","t","y","u","i","o","p","[","]"],
      ["a","s","d","f","g","h","j","k","l",";","'"],
      ["z","x","c","v","b","n","m",",",".","/"],
      ["space"]
    ];

    function renderKeyboard(activeKeys=[]){
      virtualKeyboard.innerHTML="";
      rows.forEach(r=>{
        const rowDiv=document.createElement("div");
        rowDiv.className="keyRow";
        r.forEach(k=>{
          const key=document.createElement("div");
          key.className="key";
          key.textContent=(k==="space")?"âŽµ":k;
          if(activeKeys.length>0){
            if(activeKeys.includes(k.toUpperCase()) || activeKeys.includes(k.toLowerCase())){
              key.classList.add("active");
            } else {
              key.classList.add("disabled");
            }
          }
          if(k==="space"){ key.classList.add("spacebar"); }
          rowDiv.appendChild(key);
        });
        virtualKeyboard.appendChild(rowDiv);
      });
    }

    function startTimer(){
      if(timerInterval) clearInterval(timerInterval);
      timer=0;
      timerDisplay.textContent="Time: 0s";
      timerInterval=setInterval(()=>{
        timer++;
        timerDisplay.textContent="Time: "+timer+"s";
      },1000);
    }

    function loadTopic(index){
      if(!data || !data.classes){ practiceArea.textContent="No class found."; return; }
      const topics = data.classes[0].terms[0].categories[0].topics;
      if(index<0) index=0;
      if(index>=topics.length) index=topics.length-1;
      currentTopicIndex=index;
      const topic=topics[index];

      practiceArea.innerHTML="<b>"+topic.title+"</b><br>"+topic.instruction+"<br><br>Samples: "+topic.samples.join(", ");
      score=0;
      scoreDisplay.textContent="Score: "+score;
      renderKeyboard(topic.samples);
      startTimer();
    }

    // buttons
    prevBtn.onclick=()=> loadTopic(currentTopicIndex-1);
    nextBtn.onclick=()=> loadTopic(currentTopicIndex+1);
    restartBtn.onclick=()=> loadTopic(currentTopicIndex);

    // fetch JSON
    fetch("classes.json")
      .then(r=>r.json())
      .then(json=>{
        data=json;
        loadTopic(0);
      })
      .catch(err=>{
        console.error("Error loading JSON",err);
        practiceArea.textContent="Cannot load classes.json";
        renderKeyboard(); // fallback full keyboard
      });
  </script>

</body>
</html>
