<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Typing Practice - Real Keyboard Layout</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f2f2f2; display:flex; flex-direction:column; align-items:center;}
  header { background:#4CAF50; color:white; padding:1rem; width:100%; text-align:center; }
  .container { max-width:700px; margin-top:20px; padding:1rem; background:white; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.2); text-align:center;}
  .practice-area { min-height:150px; padding:1rem; border:1px solid #ccc; border-radius:5px; background:#fafafa; display:flex; justify-content:center; align-items:center; font-size:3rem; perspective:1000px; margin-bottom:15px;}
  .key { width:60px; height:60px; line-height:60px; margin:0.3rem; text-align:center; border:2px solid #ccc; border-radius:10px; background:#e7e7e7; transform-style:preserve-3d; transition: transform 0.4s, background 0.3s;}
  .key.correct { background:#4CAF50; color:white; }
  .key.wrong { background:#f44336; color:white; }
  .flip { transform: rotateY(90deg); }
  .virtual-keyboard { display:flex; flex-direction:column; justify-content:center; gap:5px; margin-top:15px; }
  .keyboard-row { display:flex; justify-content:center; gap:5px; }
  .vk-key { width:50px; height:50px; line-height:50px; text-align:center; border-radius:5px; background:#ccc; user-select:none; cursor:default; }
  .vk-key.active { cursor:pointer; background:#e7e7e7; }
  .vk-key.highlight { background:#ffeb3b; }
  .score { font-weight:bold; margin-top:10px; }
</style>
</head>
<body>

<header><h1>SmartKids Typing Practice</h1></header>

<div class="container">
  <p id="instruction" style="margin-bottom:10px;color:#333;font-size:1.1rem;"></p>
  <div class="practice-area" id="practiceArea"></div>
  <div class="score" id="scoreDisplay">Score: 0</div>
  <div class="virtual-keyboard" id="virtualKeyboard"></div>
</div>

<script>
const practiceArea = document.getElementById('practiceArea');
const instructionEl = document.getElementById('instruction');
const scoreDisplay = document.getElementById('scoreDisplay');
const virtualKeyboard = document.getElementById('virtualKeyboard');

let score = 0;
let currentIndex = 0;
let currentLetterIndex = 0;
let currentSequence = [];

// Realistic keyboard rows
const keyboardRows = [
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L',';'],
  ['Z','X','C','V','B','N','M',',','.','/']
];

// Build virtual keyboard
function buildKeyboard() {
  virtualKeyboard.innerHTML = '';
  keyboardRows.forEach(row=>{
    const rowDiv = document.createElement('div');
    rowDiv.classList.add('keyboard-row');
    row.forEach(key=>{
      const keyDiv = document.createElement('div');
      keyDiv.classList.add('vk-key');
      keyDiv.textContent = key;
      rowDiv.appendChild(keyDiv);
    });
    virtualKeyboard.appendChild(rowDiv);
  });
}
buildKeyboard();

// Highlight virtual key
function highlightVK(keyChar,type='highlight'){
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{ 
    vk.classList.remove('highlight','correct','wrong'); 
    vk.style.backgroundColor = vk.classList.contains('active') ? '#e7e7e7' : '#ccc';
  });
  const vk = Array.from(vkKeys).find(k=>k.textContent===keyChar.toUpperCase());
  if(vk){
    vk.classList.add(type);
    if(type==='correct') vk.style.backgroundColor='#4CAF50';
    if(type==='wrong') vk.style.backgroundColor='#f44336';
    if(type==='highlight') vk.style.backgroundColor='#ffeb3b';
  }
}

// Enable only sequence keys
function enableKeysForSequence() {
  const vkKeys = document.querySelectorAll('.vk-key');
  vkKeys.forEach(vk=>{
    vk.classList.remove('active');
    if(currentSequence.some(seq=>seq.includes(vk.textContent))){
      vk.classList.add('active');
      vk.onclick = ()=>handleInput(vk.textContent);
    } else {
      vk.onclick = null;
    }
  });
}

// Show current letter/key
function showCurrentLetter(){
  if(currentIndex>=currentSequence.length){
    practiceArea.innerHTML='<p>ðŸŽ‰ Well done! You finished this topic.</p>';
    highlightVK('');
    return;
  }
  practiceArea.innerHTML='';
  const keyDiv = document.createElement('div');
  keyDiv.classList.add('key');
  keyDiv.textContent = currentSequence[currentIndex][currentLetterIndex] || currentSequence[currentIndex];
  practiceArea.appendChild(keyDiv);
  enableKeysForSequence();
  highlightVK(keyDiv.textContent,'highlight');
}

// Handle input
function handleInput(input){
  if(currentIndex>=currentSequence.length) return;
  const currentWord = currentSequence[currentIndex];
  const expectedLetter = currentWord[currentLetterIndex];
  const keyDiv = document.querySelector('.key');
  if(input.toUpperCase()===expectedLetter.toUpperCase()){
    keyDiv.classList.add('correct');
    highlightVK(expectedLetter,'correct');
    score++;
    currentLetterIndex++;
    if(currentLetterIndex>=currentWord.length){
      currentLetterIndex=0;
      currentIndex++;
    }
    setTimeout(()=>{ keyDiv.classList.add('flip'); showCurrentLetter(); },400);
  } else {
    keyDiv.classList.add('wrong');
    highlightVK(expectedLetter,'wrong');
    setTimeout(()=>{ keyDiv.classList.add('flip'); showCurrentLetter(); },400);
  }
  scoreDisplay.textContent=`Score: ${score}`;
}

// Capture real keyboard
document.addEventListener('keydown', e=>{
  const key = e.key.length===1 ? e.key : ''; // ignore Shift etc.
  handleInput(key);
});

/*
  // === FETCH JSON TOPIC DATA ===
 async function buildAccordion() {
  try {
    const res = await fetch("data/classes.json");
    if (!res.ok) throw new Error("Could not load classes.json");
    const data = await res.json();

    const container = document.getElementById("accordion");
    container.innerHTML = ""; // reset

    data.classes.forEach(year => {
      // Year header
      const yearDiv = document.createElement("div");
      yearDiv.classList.add("year");

      const yearBtn = document.createElement("button");
      yearBtn.classList.add("accordion-btn");
      yearBtn.textContent = year.name;
      yearBtn.addEventListener("click", () => {
        yearBtn.classList.toggle("active");
        yearPanel.classList.toggle("show");
      });

      const yearPanel = document.createElement("div");
      yearPanel.classList.add("accordion-panel");

      // Terms inside each year
      year.terms.forEach(term => {
        const termDiv = document.createElement("div");
        termDiv.classList.add("term");

        const termHeader = document.createElement("h4");
        termHeader.textContent = `Term ${term.number}`;
        termDiv.appendChild(termHeader);

        // Categories + topics
        term.categories.forEach(cat => {
          const catTitle = document.createElement("p");
          catTitle.classList.add("category-title");
          catTitle.textContent = cat.name;
          termDiv.appendChild(catTitle);

          const topicList = document.createElement("ul");
          cat.topics.forEach(topic => {
            const li = document.createElement("li");
            li.textContent = topic.title;

            // On click â†’ load practice
            li.addEventListener("click", () => {
              loadPractice(year.id, term.number, topic.title);
            });

            topicList.appendChild(li);
          });
          termDiv.appendChild(topicList);
        });

        yearPanel.appendChild(termDiv);
      });

      yearDiv.appendChild(yearBtn);
      yearDiv.appendChild(yearPanel);
      container.appendChild(yearDiv);
    });
  } catch (err) {
    console.error(err);
    document.getElementById("accordion").innerHTML =
      `<p style="color:red">${err.message}</p>`;
  }
}

// Call this once at startup
buildAccordion(); 
  */
  
 // === FETCH JSON TOPIC DATA ===
async function loadPractice(yearId, termNumber, topicTitle) {
  try {
    const res = await fetch('data/classes.json');
    if (!res.ok) throw new Error("Failed to load classes.json");
    const data = await res.json();

    // 1. Locate the correct year
    const year = data.classes.find(c => c.id === yearId);
    if (!year) throw new Error(`Year '${yearId}' not found`);

    // 2. Locate the correct term
    const term = year.terms.find(t => t.number === termNumber);
    if (!term) throw new Error(`Term ${termNumber} not found in ${year.name}`);

    // 3. Find topic in ANY category
    let topic;
    for (const cat of term.categories) {
      topic = cat.topics.find(tp => tp.title === topicTitle);
      if (topic) break; // stop if found
    }
    if (!topic) throw new Error(`Topic '${topicTitle}' not found`);

    // === Use samples for practice ===
    currentSequence = [...topic.samples];
    score = 0;
    currentIndex = 0;
    currentLetterIndex = 0;

    // Update UI
    scoreDisplay.textContent = "Score: 0";
    instructionBox.textContent = topic.instruction; // show guide
    showCurrentLetter();

  } catch (err) {
    practiceArea.innerHTML = `<p style="color:red">${err.message}</p>`;
    console.error(err);
  }
}


  
/*// === FETCH JSON TOPIC DATA ===
async function loadPractice(yearId, termNumber, topicTitle){
  try{
    const res = await fetch("data/classes.json"); 
    if(!res.ok) throw new Error("Failed to load classes.json");
    const data = await res.json();

    const year = data.classes.find(c => c.id === yearId);
    if(!year) throw new Error("Year not found");

    const term = year.terms.find(t => t.number === termNumber);
    if(!term) throw new Error("Term not found");

    const topic = term.categories.flatMap(cat=>cat.topics).find(tp=>tp.title===topicTitle);
    if(!topic) throw new Error("Topic not found");

    currentSequence = [...topic.samples];
    score = 0;
    currentIndex = 0;
    currentLetterIndex = 0;
    scoreDisplay.textContent = "Score: 0";
    instructionEl.textContent = topic.instruction;

    showCurrentLetter();
  }catch(err){
    practiceArea.innerHTML = `<p style="color:red">${err.message}</p>`;
    console.error(err);
  }
}

// Example call (replace with URL params if needed)
loadPractice("year1",1,"Home Row Keys");*/
</script>
</body>
</html>
