<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Typing Tutor</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f9fafb; margin:20px; }
    #accordion .card { margin-bottom:10px; border-radius:10px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .accordion-header { width:100%; display:flex; justify-content:space-between; padding:12px 16px; font-weight:bold; background:#e0f2fe; border:none; cursor:pointer; transition:background 0.3s; }
    .accordion-header:hover { background:#bae6fd; }
    .accordion-body { max-height:0; overflow:hidden; transition:max-height 0.5s ease; background:#f8fafc; }
    .accordion-body.open { padding:8px 0; }
    .accordion-body ul { list-style:none; padding-left:20px; }
    .accordion-body li { margin:5px 0; }
    .accordion-body a { display:block; padding:8px; border-radius:6px; text-decoration:none; background:#fff; color:#111; box-shadow:0 1px 3px rgba(0,0,0,0.1); transition:all 0.3s; }
    .accordion-body a:hover { background:#f1f5f9; }

    /* Game area */
    #practiceArea { margin-top:20px; padding:16px; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    #score { font-weight:bold; margin-bottom:10px; }

    /* Virtual keyboard */
    #keyboard { margin-top:20px; display:grid; grid-template-columns:repeat(10, 1fr); gap:5px; }
    .key { padding:12px; text-align:center; background:#e5e7eb; border-radius:6px; font-weight:bold; transition:0.2s; }
    .key.active { background:#3b82f6; color:#fff; transform:scale(1.1); }
  </style>
</head>
<body>
  <h1>Typing Tutor for Kids</h1>

  <div id="accordion"></div>

  <div id="practiceArea">
    <div id="score">Score: 0</div>
    <div id="textDisplay"></div>
  </div>

  <div id="keyboard"></div>

  <script>
    let currentSequence = [];
    let score = 0;
    let currentIndex = 0;
    const scoreDisplay = document.getElementById("score");
    const textDisplay = document.getElementById("textDisplay");

    // Build virtual keyboard
    const keys = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    const keyboardDiv = document.getElementById("keyboard");
    keys.forEach(k=>{
      const keyDiv = document.createElement("div");
      keyDiv.className="key";
      keyDiv.id="key-"+k;
      keyDiv.textContent=k;
      keyboardDiv.appendChild(keyDiv);
    });

    // Show current practice letter
    function showCurrentLetter(){
      if(currentIndex<currentSequence.length){
        textDisplay.textContent=currentSequence[currentIndex];
      }else{
        textDisplay.textContent="✅ Well done!";
      }
    }

    // Typing logic
    document.addEventListener("keydown", (e)=>{
      const pressed = e.key.toUpperCase();
      const keyDiv = document.getElementById("key-"+pressed);
      if(keyDiv){
        keyDiv.classList.add("active");
        setTimeout(()=>keyDiv.classList.remove("active"),200);
      }
      if(currentSequence[currentIndex] && pressed===currentSequence[currentIndex].toUpperCase()){
        score++;
        scoreDisplay.textContent="Score: "+score;
        currentIndex++;
        showCurrentLetter();
      }
    });

    // Load JSON & build accordion
    async function buildAccordion(){
      const container = document.getElementById("accordion");
      try{
        const res = await fetch("data/classes.json");
        const data = await res.json();
        const classes = Array.isArray(data) ? data : data.classes;

        classes.forEach(cls=>{
          const card=document.createElement("div"); card.className="card";
          const header=document.createElement("button");
          header.className="accordion-header";
          header.innerHTML=`<span>${cls.name}</span><span>+</span>`;
          card.appendChild(header);

          const body=document.createElement("div");
          body.className="accordion-body";

          body.innerHTML=(cls.terms||[]).map(term=>`
            <h3 style="margin:8px 16px; color:#1d4ed8">${term.title}</h3>
            ${(term.categories||[]).map(cat=>`
              <h4 style="margin:4px 24px; color:#9333ea">${cat.name}</h4>
              <ul>
                ${(cat.topics||[]).map((topic,idx)=>`
                  <li><a href="#" data-year="${cls.id}" data-term="${term.number}" data-cat="${cat.id}" data-topic="${idx}">
                    ${topic.title}
                  </a></li>
                `).join("")}
              </ul>
            `).join("")}
          `).join("");

          card.appendChild(body);
          header.addEventListener("click",()=>{
            body.classList.toggle("open");
            if(body.classList.contains("open")){
              body.style.maxHeight=body.scrollHeight+"px";
              header.querySelector("span:last-child").textContent="−";
            }else{
              body.style.maxHeight=null;
              header.querySelector("span:last-child").textContent="+";
            }
          });

          container.appendChild(card);
        });

        // Topic click → load samples
        container.addEventListener("click",(e)=>{
          if(e.target.tagName==="A"){
            e.preventDefault();
            const yearId=e.target.dataset.year;
            const termNumber=parseInt(e.target.dataset.term);
            const catId=e.target.dataset.cat;
            const topicIndex=parseInt(e.target.dataset.topic);
            loadPractice(yearId,termNumber,catId,topicIndex);
          }
        });
      }catch(err){
        console.error(err);
        container.innerHTML="<p style='color:red'>⚠ Failed to load data</p>";
      }
    }

    async function loadPractice(yearId,termNumber,catId,topicIndex){
      try{
        const res = await fetch("data/classes.json");
        const data = await res.json();
        const classes = Array.isArray(data) ? data : data.classes;

        const year=classes.find(c=>c.id===yearId);
        const term=year.terms.find(t=>t.number===termNumber);
        const cat=term.categories.find(c=>c.id===catId);
        const topic=cat.topics[topicIndex];

        currentSequence=[...topic.samples];
        score=0; currentIndex=0;
        scoreDisplay.textContent="Score: 0";
        showCurrentLetter();
      }catch(err){
        console.error(err);
        textDisplay.textContent="Error loading practice";
      }
    }

    buildAccordion();
  </script>
</body>
</html>
