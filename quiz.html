<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartKids Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Navbar -->
  <nav class="bg-blue-600 text-white p-4 shadow flex justify-between items-center">
    <h1 class="text-xl font-bold">SmartKids Quiz</h1>
    <div class="flex space-x-4">
      <a href="classes.html" class="bg-green-500 px-3 py-1 rounded hover:bg-green-600">Keyboard Tutor</a>
      <a href="mouse.html" class="bg-purple-500 px-3 py-1 rounded hover:bg-purple-600">Mouse Practice</a>
    </div>
  </nav>

  <!-- Quiz Container -->
  <div class="container mx-auto mt-6 p-4 bg-white rounded shadow" id="quizContainer">
    <h2 class="text-2xl font-bold mb-4 text-center text-blue-700">🧩 SmartKids Quiz Challenge</h2>

    <form id="quizForm" class="space-y-6"></form>

    <!-- Navigation Buttons -->
    <div class="flex justify-between mt-6">
      <button id="prevBtn" class="bg-gray-400 text-white px-4 py-2 rounded hidden">Previous</button>
      <button id="submitBtn" class="bg-blue-600 text-white px-4 py-2 rounded">Submit</button>
      <button id="nextBtn" class="bg-green-600 text-white px-4 py-2 rounded hidden">Next</button>
    </div>
  </div>

  <!-- Report Card -->
  <div class="container mx-auto mt-6 p-4 bg-white rounded shadow hidden" id="reportCard">
    <h2 class="text-xl font-bold mb-4">📊 Mini Report Card</h2>
    <p id="scoreSummary" class="text-lg font-semibold mb-2"></p>
    <p id="feedbackMessage" class="text-md"></p>
  </div>

<script>
  let allQuestions = [];
  let currentPage = 0;
  const pageSize = 5;
  let totalScore = 0;
  let timer, timeLeft = 75;
  let isPaused = false;

  const quizContainer = document.getElementById("quizContainer");
  const quizForm = document.getElementById("quizForm");
  const prevBtn = document.getElementById("prevBtn");
  const submitBtn = document.getElementById("submitBtn");
  const reportCard = document.getElementById("reportCard");
  const scoreSummary = document.getElementById("scoreSummary");
  const feedbackMessage = document.getElementById("feedbackMessage");

  // ------------------ Floating Circular Timer ------------------
  const timerContainer = document.createElement("div");
  timerContainer.className =
    "fixed top-4 right-4 w-20 h-20 z-50 flex items-center justify-center rounded-full border-4 border-gray-300 bg-white shadow-xl";
  timerContainer.innerHTML = `
    <svg class="absolute inset-0" viewBox="0 0 36 36">
      <path stroke="#e5e7eb" stroke-width="3.8" fill="none"
        d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"/>
      <path id="timerPath" stroke="#22c55e" stroke-width="3.8" stroke-dasharray="100, 100" fill="none"
        d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"/>
    </svg>
    <span id="timerText" class="text-lg font-bold text-gray-700">75</span>
  `;
  document.body.appendChild(timerContainer);

  // ------------------ Load Questions ------------------
  async function loadQuestions() {
    const res = await fetch("data/quiz.json");
    const data = await res.json();
    allQuestions = shuffleArray(data.quiz);
    renderPage();
    startTimer();
  }

  // ------------------ Render Page ------------------
  function renderPage() {
    quizForm.innerHTML = "";
    const start = currentPage * pageSize;
    const end = start + pageSize;
    const pageQuestions = allQuestions.slice(start, end);

    pageQuestions.forEach((q, index) => {
      const div = document.createElement("div");
      div.classList.add("p-4", "border", "rounded", "bg-gray-50", "mb-3");
      div.innerHTML = `
        <p class="font-semibold mb-2">${start + index + 1}. ${q.question}</p>
        ${shuffleArray(q.options)
          .map(
            (opt) => `
          <label class="block cursor-pointer">
            <input type="radio" name="q${q.id}" value="${opt}" class="mr-2">
            ${opt}
          </label>`
          )
          .join("")}
      `;
      quizForm.appendChild(div);
    });

    prevBtn.classList.toggle("hidden", currentPage === 0);
  }

  // ------------------ Timer Logic ------------------
  function startTimer() {
    clearInterval(timer);
    timeLeft = 75;
    isPaused = false;
    updateTimerUI();

    timer = setInterval(() => {
      if (!isPaused) {
        timeLeft--;
        updateTimerUI();
        if (timeLeft <= 0) {
          clearInterval(timer);
          showNotification("⏰ Time's up! Submitting answers automatically...");
          submitBtn.click();
        }
      }
    }, 1000);
  }

  function updateTimerUI() {
    const percent = (timeLeft / 75) * 100;
    const timerPath = document.getElementById("timerPath");
    const timerText = document.getElementById("timerText");

    timerPath.setAttribute("stroke-dasharray", `${percent}, 100`);
    timerPath.setAttribute("stroke", timeLeft < 15 ? "#ef4444" : "#22c55e");
    timerText.textContent = timeLeft;
  }

  // ------------------ Pause on Tab Switch ------------------
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      isPaused = true;
      showNotification("⏸️ Timer paused — you switched tabs!");
    } else {
      isPaused = false;
      showNotification("▶️ Timer resumed — welcome back!");
    }
  });

  // ------------------ Submit Logic ------------------
  submitBtn.addEventListener("click", (e) => {
    e.preventDefault();
    clearInterval(timer);

    let score = 0;
    const start = currentPage * pageSize;
    const end = start + pageSize;
    const pageQuestions = allQuestions.slice(start, end);

    pageQuestions.forEach((q) => {
      const selected = quizForm.querySelector(`input[name="q${q.id}"]:checked`);
      if (selected && selected.value === q.answer) score++;
    });

    totalScore += score;
    const totalAttempted = Math.min(end, allQuestions.length);
    const totalPossible = totalAttempted;
    const percentage = Math.round((totalScore / totalPossible) * 100);

    showNotification(`✅ You scored ${score} / ${pageQuestions.length} on this page.`);

    // Feedback message
    if (percentage < 50) feedbackMessage.textContent = "💪 Keep trying! You can do better!";
    else if (percentage < 80) feedbackMessage.textContent = "👏 Good effort! You're improving!";
    else if (percentage < 90) feedbackMessage.textContent = "🌟 Great work! Almost perfect!";
    else feedbackMessage.textContent = "🏆 Excellent! You are a SmartKid star!";

    if (end < allQuestions.length) {
      currentPage++;
      renderPage();
      startTimer();
    } else {
      finishQuiz(percentage);
    }
  });

  // ------------------ Finish Quiz ------------------
  function finishQuiz(percentage) {
    quizContainer.classList.add("hidden");
    reportCard.classList.remove("hidden");
    scoreSummary.textContent = `🎯 Final Score: ${totalScore} / ${allQuestions.length} (${percentage}%)`;

    if (percentage < 88) {
      showNotification("😅 You scored below 22 out of 25. Restarting...");
      setTimeout(() => restartQuiz(), 3000);
    } else {
      saveScore(totalScore, allQuestions.length, percentage);
    }
  }

  // ------------------ Restart Quiz ------------------
  function restartQuiz() {
    totalScore = 0;
    currentPage = 0;
    shuffleArray(allQuestions);
    reportCard.classList.add("hidden");
    quizContainer.classList.remove("hidden");
    renderPage();
    startTimer();
  }

  // ------------------ Stylish Notification ------------------
  function showNotification(message) {
    let note = document.createElement("div");
    note.className =
      "fixed top-5 right-5 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-5 py-3 rounded-xl shadow-lg text-sm font-semibold z-[9999] transition-all duration-500";
    note.textContent = message;
    document.body.appendChild(note);
    setTimeout(() => {
      note.style.opacity = "0";
      note.style.transform = "translateY(-10px)";
      setTimeout(() => note.remove(), 500);
    }, 3000);
  }

  // ------------------ Shuffle Helper ------------------
  function shuffleArray(array) {
    return array.sort(() => Math.random() - 0.5);
  }

  // ------------------ IndexedDB Save ------------------
  function saveScore(score, total, percentage) {
    const request = indexedDB.open("SmartKidsDB", 1);
    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      if (!db.objectStoreNames.contains("quizScores")) {
        const store = db.createObjectStore("quizScores", { keyPath: "id", autoIncrement: true });
        store.createIndex("userId", "userId", { unique: false });
        store.createIndex("category", "category", { unique: false });
      }
    };
    request.onsuccess = (event) => {
      const db = event.target.result;
      const tx = db.transaction("quizScores", "readwrite");
      const store = tx.objectStore("quizScores");
      store.add({
        userId: localStorage.getItem("currentUserId") || "guest",
        name: localStorage.getItem("currentUserName") || "Guest",
        score,
        total,
        percentage,
        date: new Date().toISOString(),
      });
    };
  }

  // ------------------ Start Quiz ------------------
  loadQuestions();
</script>

  <!--
<script>
  let allQuestions = [];
  let currentPage = 0;
  const pageSize = 5;
  let totalScore = 0;
  let timer, timeLeft = 75;

  const quizContainer = document.getElementById("quizContainer");
  const quizForm = document.getElementById("quizForm");
  const prevBtn = document.getElementById("prevBtn");
  const submitBtn = document.getElementById("submitBtn");
  const reportCard = document.getElementById("reportCard");
  const scoreSummary = document.getElementById("scoreSummary");
  const feedbackMessage = document.getElementById("feedbackMessage");

  // Create circular timer dynamically
  const timerContainer = document.createElement("div");
  timerContainer.className =
    "relative mx-auto mt-4 w-20 h-20 flex items-center justify-center rounded-full border-4 border-gray-300";
  timerContainer.innerHTML = `
    <svg class="absolute inset-0" viewBox="0 0 36 36">
      <path class="timer-bg" stroke="#e5e7eb" stroke-width="3.8" fill="none"
        d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"/>
      <path id="timerPath" class="timer-progress" stroke="#22c55e" stroke-width="3.8" stroke-dasharray="100, 100" fill="none"
        d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"/>
    </svg>
    <span id="timerText" class="text-lg font-bold text-gray-700">75</span>
  `;
  quizContainer.insertBefore(timerContainer, quizForm);

  // ------------------ Load Questions ------------------
  async function loadQuestions() {
    const res = await fetch("data/quiz.json");
    const data = await res.json();
    allQuestions = shuffleArray(data.quiz);
    renderPage();
    startTimer();
  }

  // ------------------ Render Page ------------------
  function renderPage() {
    quizForm.innerHTML = "";
    const start = currentPage * pageSize;
    const end = start + pageSize;
    const pageQuestions = allQuestions.slice(start, end);

    pageQuestions.forEach((q, index) => {
      const div = document.createElement("div");
      div.classList.add("p-4", "border", "rounded", "bg-gray-50", "mb-2");
      div.innerHTML = `
        <p class="font-semibold mb-2">${start + index + 1}. ${q.question}</p>
        ${shuffleArray(q.options)
          .map(
            (opt) => `
          <label class="block cursor-pointer">
            <input type="radio" name="q${q.id}" value="${opt}" class="mr-2">
            ${opt}
          </label>`
          )
          .join("")}
      `;
      quizForm.appendChild(div);
    });

    prevBtn.classList.toggle("hidden", currentPage === 0);
  }

  // ------------------ Timer Logic ------------------
  function startTimer() {
    clearInterval(timer);
    timeLeft = 75;
    updateTimerUI();
    timer = setInterval(() => {
      timeLeft--;
      updateTimerUI();
      if (timeLeft <= 0) {
        clearInterval(timer);
        showNotification("⏰ Time's up! Submitting answers automatically...");
        submitBtn.click();
      }
    }, 1000);
  }

  function updateTimerUI() {
    const percent = (timeLeft / 75) * 100;
    const timerPath = document.getElementById("timerPath");
    const timerText = document.getElementById("timerText");
    timerPath.setAttribute("stroke-dasharray", `${percent}, 100`);
    timerPath.setAttribute("stroke", timeLeft < 15 ? "#ef4444" : "#22c55e");
    timerText.textContent = timeLeft;
  }

  // ------------------ Submit Logic ------------------
  submitBtn.addEventListener("click", (e) => {
    e.preventDefault();
    clearInterval(timer);
    let score = 0;
    const start = currentPage * pageSize;
    const end = start + pageSize;
    const pageQuestions = allQuestions.slice(start, end);

    pageQuestions.forEach((q) => {
      const selected = quizForm.querySelector(`input[name="q${q.id}"]:checked`);
      if (selected && selected.value === q.answer) score++;
    });

    totalScore += score;
    const totalAttempted = Math.min(end, allQuestions.length);
    const totalPossible = totalAttempted;
    const percentage = Math.round((totalScore / totalPossible) * 100);

    showNotification(`✅ You scored ${score} / ${pageQuestions.length} on this page.`);

    if (percentage < 50) {
      feedbackMessage.textContent = "💪 Keep trying! You can do better!";
    } else if (percentage < 80) {
      feedbackMessage.textContent = "👏 Good effort! You're improving!";
    } else if (percentage < 90) {
      feedbackMessage.textContent = "🌟 Great work! Almost perfect!";
    } else {
      feedbackMessage.textContent = "🏆 Excellent! You are a SmartKid star!";
    }

    if (end < allQuestions.length) {
      currentPage++;
      renderPage();
      startTimer();
    } else {
      finishQuiz(percentage);
    }
  });

  // ------------------ Finish Quiz ------------------
  function finishQuiz(percentage) {
    quizContainer.classList.add("hidden");
    reportCard.classList.remove("hidden");
    scoreSummary.textContent = `🎯 Final Score: ${totalScore} / ${allQuestions.length} (${percentage}%)`;

    if (percentage < 88) {
      showNotification("😅 You scored below 22 out of 25. Restarting...");
      setTimeout(() => restartQuiz(), 3000);
    } else {
      saveScore(totalScore, allQuestions.length, percentage);
    }
  }

  // ------------------ Restart Quiz ------------------
  function restartQuiz() {
    totalScore = 0;
    currentPage = 0;
    shuffleArray(allQuestions);
    reportCard.classList.add("hidden");
    quizContainer.classList.remove("hidden");
    renderPage();
    startTimer();
  }

  // ------------------ Stylish Notifications ------------------
  function showNotification(message) {
    let note = document.createElement("div");
    note.className =
      "fixed top-5 right-5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-5 py-3 rounded-xl shadow-lg text-sm font-semibold z-50 transition-all animate-bounce";
    note.textContent = message;
    document.body.appendChild(note);
    setTimeout(() => {
      note.classList.add("opacity-0", "translate-y-2");
      setTimeout(() => note.remove(), 500);
    }, 3000);
  }

  // ------------------ Shuffle Helper ------------------
  function shuffleArray(array) {
    return array.sort(() => Math.random() - 0.5);
  }

  // ------------------ IndexedDB Save ------------------
  function saveScore(score, total, percentage) {
    const request = indexedDB.open("SmartKidsDB", 1);
    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      if (!db.objectStoreNames.contains("quizScores")) {
        const store = db.createObjectStore("quizScores", { keyPath: "id", autoIncrement: true });
        store.createIndex("userId", "userId", { unique: false });
        store.createIndex("category", "category", { unique: false });
      }
    };
    request.onsuccess = (event) => {
      const db = event.target.result;
      const tx = db.transaction("quizScores", "readwrite");
      const store = tx.objectStore("quizScores");
      store.add({
        userId: localStorage.getItem("currentUserId") || "guest",
        name: localStorage.getItem("currentUserName") || "Guest",
        score,
        total,
        percentage,
        date: new Date().toISOString(),
      });
    };
  }

  // ------------------ Start Quiz ------------------
  loadQuestions();
</script>



  <!--
  <script>
    let allQuestions = [];
    let currentPage = 0;
    const pageSize = 5;
    let totalScore = 0;

    const quizContainer = document.getElementById("quizContainer");
    const quizForm = document.getElementById("quizForm");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const submitBtn = document.getElementById("submitBtn");
    const reportCard = document.getElementById("reportCard");
    const scoreSummary = document.getElementById("scoreSummary");
    const feedbackMessage = document.getElementById("feedbackMessage");

    // ------------------ Load Questions ------------------
    async function loadQuestions() {
      const res = await fetch("data/quiz.json");
      const data = await res.json();
      // shuffle all questions for fairness
      allQuestions = shuffleArray(data.quiz);
      renderPage();
    }

    // ------------------ Render Page ------------------
    function renderPage() {
      quizForm.innerHTML = "";
      const start = currentPage * pageSize;
      const end = start + pageSize;
      const pageQuestions = allQuestions.slice(start, end);

      pageQuestions.forEach((q, index) => {
        const div = document.createElement("div");
        div.classList.add("p-4", "border", "rounded", "bg-gray-50");
        div.innerHTML = `
          <p class="font-semibold mb-2">${start + index + 1}. ${q.question}</p>
          ${shuffleArray(q.options).map(opt => `
            <label class="block cursor-pointer">
              <input type="radio" name="q${q.id}" value="${opt}" class="mr-2">
              ${opt}
            </label>
          `).join("")}
        `;
        quizForm.appendChild(div);
      });

      prevBtn.classList.toggle("hidden", currentPage === 0);
      nextBtn.classList.add("hidden");
    }

    // ------------------ Submit Logic ------------------
    submitBtn.addEventListener("click", (e) => {
      e.preventDefault();
      let score = 0;
      const start = currentPage * pageSize;
      const end = start + pageSize;
      const pageQuestions = allQuestions.slice(start, end);

      pageQuestions.forEach(q => {
        const selected = quizForm.querySelector(`input[name="q${q.id}"]:checked`);
        if (selected && selected.value === q.answer) score++;
      });

      totalScore += score;
      const totalAttempted = Math.min(end, allQuestions.length);
      const totalPossible = totalAttempted;

      const percentage = Math.round((totalScore / totalPossible) * 100);

      alert(`✅ You scored ${score} out of ${pageQuestions.length} on this page.`);

      // Feedback message
      if (percentage < 50) {
        feedbackMessage.textContent = "💪 Keep trying! You can do better!";
      } else if (percentage < 80) {
        feedbackMessage.textContent = "👏 Good effort! You're improving!";
      } else if (percentage < 90) {
        feedbackMessage.textContent = "🌟 Great work! Almost perfect!";
      } else {
        feedbackMessage.textContent = "🏆 Excellent! You are a SmartKid star!";
      }

      // Move to next page or finish
      if (end < allQuestions.length) {
        currentPage++;
        renderPage();
      } else {
        finishQuiz(percentage);
      }
    });

    // ------------------ Finish Quiz ------------------
    function finishQuiz(percentage) {
      quizContainer.classList.add("hidden");
      reportCard.classList.remove("hidden");

      scoreSummary.textContent = `🎯 Final Score: ${totalScore} / ${allQuestions.length} (${percentage}%)`;

      if (percentage < 88) {
        alert("😅 You scored below 22 out of 25. Let's try again!");
        restartQuiz();
      } else {
        saveScore(totalScore, allQuestions.length, percentage);
      }
    }

    // ------------------ Restart Quiz ------------------
    function restartQuiz() {
      totalScore = 0;
      currentPage = 0;
      shuffleArray(allQuestions);
      reportCard.classList.add("hidden");
      quizContainer.classList.remove("hidden");
      renderPage();
    }

    // ------------------ Shuffle Helper ------------------
    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    // ------------------ IndexedDB Save ------------------
    function saveScore(score, total, percentage) {
      const request = indexedDB.open("SmartKidsDB", 1);
      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        if (!db.objectStoreNames.contains("quizScores")) {
          const store = db.createObjectStore("quizScores", { keyPath: "id", autoIncrement: true });
          store.createIndex("userId", "userId", { unique: false });
          store.createIndex("category", "category", { unique: false });
        }
      };

      request.onsuccess = (event) => {
        const db = event.target.result;
        const tx = db.transaction("quizScores", "readwrite");
        const store = tx.objectStore("quizScores");
        store.add({
          userId: localStorage.getItem("currentUserId") || "guest",
          name: localStorage.getItem("currentUserName") || "Guest",
          score,
          total,
          percentage,
          date: new Date().toISOString()
        });
      };
    }

    // ------------------ Start Quiz ------------------
    loadQuestions();
  </script>-->
</body>
</html>
