<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartKids Learning - Classes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .accordion-body { max-height: 0; overflow: hidden; transition: max-height 0.5s ease; }
    .accordion-header span:last-child { transition: transform 0.3s ease; }
    .hidden { display: none; }
    .key {
      display: inline-block;
      padding: 8px 10px;
      margin: 2px;
      background: #eee;
      border-radius: 6px;
      border: 2px solid transparent;
      transition: background 0.2s, border 0.2s, box-shadow 0.2s;
      user-select: none;
      text-align: center;
      min-width: 35px;
    }
    .key.highlight { background: #3498db !important; color: #fff !important; }
    .key.pressed { border: 2px solid white !important; box-shadow: 0 0 8px white; }
    .correct { color: green; }
    .incorrect { color: red; text-decoration: underline; }
    .current { text-decoration: underline; text-decoration-thickness: 2px; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

  <!-- Header -->
  <header class="bg-blue-600 text-white shadow-md fixed top-0 left-0 w-full z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl font-bold">SmartKids Learning</h1>
      <a href="index.html" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium shadow hover:bg-blue-100 transition">Home</a>
    </div>
  </header>

  <!-- Content -->
  <main class="pt-24 max-w-4xl mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-8">Select Your Class</h2>
    <div id="accordion" class="space-y-4"></div>
  </main>

  <!-- Typing Tutor Modal -->
  <div id="tutorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 max-w-2xl w-full shadow-lg relative">
      <button id="closeTutor" class="absolute top-2 right-2 text-red-600 text-xl font-bold">&times;</button>
      <h2 id="lessonTitle" class="text-xl font-bold mb-4">Typing Tutor</h2>

      <!-- Highlighted Sample Text -->
      <div id="lessonText" class="mb-4 p-3 bg-gray-100 rounded text-lg leading-relaxed"></div>

      <!-- Typing Area -->
      <textarea id="typingArea" rows="4" class="w-full border p-3 rounded mb-4" placeholder="Start typing here..."></textarea>

      <!-- Stats -->
      <div class="flex justify-between text-sm font-semibold mb-4">
        <span>WPM: <span id="wpm">0</span></span>
        <span>Errors: <span id="errors">0</span></span>
        <span>Accuracy: <span id="accuracy">100</span>%</span>
      </div>

      <div class="flex justify-between mt-4">
        <button id="btnPrev" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">‚¨Ö Prev</button>
        <button id="btnRestart" class="px-4 py-2 bg-yellow-200 rounded hover:bg-yellow-300">üîÑ Restart</button>
        <button id="btnNext" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Next ‚û°</button>
      </div>

      <!-- Virtual Keyboard -->
      <div id="keyboard" class="p-2 bg-gray-200 rounded mt-4"></div>
    </div>
  </div>
<script>
// keyboard.js
document.addEventListener("DOMContentLoaded", () => {
  // --- DOM references (keep these ids in your HTML) ---
  const startKeyboardBtn = document.getElementById("keyboardMode");
  const startMouseBtn = document.getElementById("mouseMode");
  const practiceArea = document.getElementById("practiceArea");
  const targetChar = document.getElementById("targetChar");
  const feedbackEl = document.getElementById("feedback");
  const virtualKeyboard = document.getElementById("virtualKeyboard");
  const mouseBoard = document.getElementById("mouseBoard");

  // optional control buttons; create if missing (so we don't touch your accordion)
  let nextBtn = document.getElementById("nextBtn");
  let restartBtn = document.getElementById("restartBtn");
  const ensureControlsExist = () => {
    if (!nextBtn || !restartBtn) {
      // try to append to an existing controls container if present
      let controlsContainer = document.getElementById("practiceControls");
      if (!controlsContainer) {
        controlsContainer = document.createElement("div");
        controlsContainer.id = "practiceControls";
        controlsContainer.style.marginTop = "8px";
        // append after practiceArea (safe; doesn't touch accordion)
        practiceArea?.parentNode?.insertBefore(controlsContainer, practiceArea.nextSibling);
      }

      if (!nextBtn) {
        nextBtn = document.createElement("button");
        nextBtn.id = "nextBtn";
        nextBtn.textContent = "Next";
        nextBtn.className = "btn-next hidden";
        nextBtn.style.marginRight = "8px";
        controlsContainer.appendChild(nextBtn);
      }
      if (!restartBtn) {
        restartBtn = document.createElement("button");
        restartBtn.id = "restartBtn";
        restartBtn.textContent = "Restart";
        restartBtn.className = "btn-restart hidden";
        controlsContainer.appendChild(restartBtn);
      }
    }
  };

  ensureControlsExist();

  // --- state ---
  let classesData = null;
  let topics = []; // normalized array of { title, link?, content? }
  let currentTopicIndex = 0;
  let currentChars = []; // array of characters for typing
  let currentCharIndex = 0;
  let mode = ""; // "keyboard" | "mouse"

  // track current selection (we pick first year/term by default)
  let currentYearKey = null;
  let currentTermKey = null;

  // --- utility: try fetch data path fallback ---
  async function tryFetchPaths(paths = []) {
    for (const p of paths) {
      try {
        const res = await fetch(p);
        if (res && res.ok) return await res.json();
      } catch (e) {
        // ignore and try next
      }
    }
    throw new Error("None of the fetch paths returned JSON: " + paths.join(", "));
  }

  // --- load classes.json (supports object or array formats) ---
  async function loadClasses() {
    try {
      // try common paths: data/classes.json then classes.json
      classesData = await tryFetchPaths(["data/classes.json", "classes.json"]);
    } catch (err) {
      console.error("Failed to load classes.json:", err);
      classesData = null;
      return;
    }

    // Normalize topics for the first year & first term
    if (Array.isArray(classesData)) {
      // expected shape: [{ year/name, terms: [{ name, topics: [{ title, link?, content? }] }] }, ...]
      const firstClass = classesData[0] || {};
      currentYearKey = firstClass.name || firstClass.year || "Year 1";
      const firstTerm = (firstClass.terms && firstClass.terms[0]) || { name: "Term 1", topics: [] };
      currentTermKey = firstTerm.name || "Term 1";
      topics = (firstTerm.topics || []).map(t => {
        // if topic stored as string link, normalize
        if (typeof t === "string") return { title: t, link: t };
        return { title: t.title || t.name || "Topic", link: t.link, content: t.content };
      });
    } else if (typeof classesData === "object" && classesData !== null) {
      // expected shape: { "Year 1": { "Term 1": { "Topic A": { content: [...], link? }, ... }, ... }, ... }
      const yearKeys = Object.keys(classesData);
      currentYearKey = yearKeys[0];
      const termObj = classesData[currentYearKey];
      const termKeys = Object.keys(termObj || {});
      currentTermKey = termKeys[0];
      const topicsObj = (termObj && termObj[currentTermKey]) || {};
      topics = Object.keys(topicsObj).map(topicName => {
        const t = topicsObj[topicName];
        if (typeof t === "string") {
          // topic is a link string
          return { title: topicName, link: t };
        } else if (t && typeof t === "object") {
          return { title: topicName, link: t.link, content: t.content };
        } else {
          return { title: topicName, content: "" };
        }
      });
    } else {
      topics = [];
    }
  }

  // --- load a single topic (either inline content or via link) ---
  async function loadTopicByIndex(index) {
    if (!topics || index < 0 || index >= topics.length) {
      console.warn("Invalid topic index", index);
      return;
    }
    const topic = topics[index];

    // hide controls while loading
    nextBtn.classList.add("hidden");
    restartBtn.classList.add("hidden");
    feedbackEl.textContent = "";

    let topicData = null;
    if (topic.content) {
      // content may be string or array
      topicData = { content: topic.content };
    } else if (topic.link) {
      // try to fetch link; support relative paths
      try {
        const res = await fetch(topic.link);
        if (res && res.ok) topicData = await res.json();
      } catch (err) {
        console.error("Failed to fetch topic link:", topic.link, err);
      }
    }

    // fallback: if topicData not found but topic.title exists and topics.json stored the text
    if (!topicData) {
      // try to use title as content (rare)
      topicData = { content: topic.title || "" };
    }

    // resolve content to a single string we will make chars from
    let text = "";
    if (Array.isArray(topicData.content) && topicData.content.length > 0) {
      // if content is array of strings, pick the first sample by default
      text = String(topicData.content[0]);
    } else {
      text = String(topicData.content || "");
    }

    // set up typing chars
    currentChars = text.split("");
    currentCharIndex = 0;
    currentTopicIndex = index;

    // For clarity in UI: show which topic is loaded if your accordion has an element for it
    // (we do not modify the accordion DOM itself)
    if (practiceArea) {
      // keep existing practiceArea content, just clear any old mouseboard/keyboard state
      // we intentionally do not overwrite accordion
    }

    // Render keyboard for the first required char and load
    renderKeyboardForChar(currentChars[currentCharIndex]);
    mode === "keyboard" ? loadKeyboardItem() : loadMouseItem();
  }

  // --- KEYBOARD MODE: render and flow ---
  function loadKeyboardItem() {
    if (currentCharIndex >= currentChars.length) {
      // finished topic
      feedbackEl.textContent = "‚úÖ Topic complete";
      feedbackEl.className = "text-green-600 font-semibold";
      if (currentTopicIndex < topics.length - 1) {
        nextBtn.classList.remove("hidden");
      } else {
        restartBtn.classList.remove("hidden");
        feedbackEl.textContent = "üéâ Term complete!";
      }
      return;
    }

    const ch = currentChars[currentCharIndex];
    // Display target char in lowercase so kids type lowercase
    targetChar.textContent = String(ch).toLowerCase();
    feedbackEl.textContent = "";
    // auto-switch keyboard layout if needed
    renderKeyboardForChar(ch);
    // highlight expected key if present
    highlightKey(ch);
  }

  function checkKeyboardInput(inputRaw) {
    if (currentCharIndex >= currentChars.length) return;
    const expected = String(currentChars[currentCharIndex] || "").toLowerCase();
    const input = String(inputRaw || "").toLowerCase();

    if (input === expected) {
      feedbackEl.textContent = "‚úÖ Correct!";
      feedbackEl.className = "text-green-600 font-semibold";
      currentCharIndex++;
      setTimeout(loadKeyboardItem, 180); // brief delay then next char
    } else {
      feedbackEl.textContent = "‚ùå Try again!";
      feedbackEl.className = "text-red-600 font-semibold";
      // keep cursor on same char
    }
  }

  // highlight the key button (if present)
  function highlightKey(ch) {
    if (!virtualKeyboard) return;
    document.querySelectorAll("#" + virtualKeyboard.id + " .key").forEach(el => el.classList.remove("highlight"));
    const keySelector = `[data-key="${escapeSelector(String(ch).toLowerCase())}"]`;
    const btn = virtualKeyboard.querySelector(keySelector);
    if (btn) btn.classList.add("highlight");
  }

  // escape CSS selector for special characters
  function escapeSelector(s) {
    return s.replace(/([ !"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~])/g, "\\$1");
  }

  // --- Render keyboard layout: show full rows (lowercase). Auto-switch between letters/numbers/symbols ---
  function renderKeyboardForChar(ch) {
    if (!virtualKeyboard) return;

    // determine type of character
    const str = String(ch || "");
    let type = "letters";
    if (/[0-9]/.test(str)) type = "numbers";
    else if (/[\.\,\!\?\;\:\-\/@#\$%\^&\*\(\)\+\=\[\]\{\}"'<>\\|`~]/.test(str)) type = "symbols";
    else if (str === " ") type = "letters"; // show letters with a visible spacebar

    // keep a consistent full layout for each type (lowercase)
    virtualKeyboard.innerHTML = ""; // only clear keyboard area (safe)

    const makeRow = (keys) => {
      const row = document.createElement("div");
      row.className = "vk-row";
      keys.forEach(k => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "key vk-key";
        btn.dataset.key = k;
        btn.textContent = k === " " ? "‚ê£" : k;
        // simple styling to prevent accidental accordion changes (your CSS may override)
        btn.style.padding = "6px 10px";
        btn.style.margin = "3px";
        btn.style.minWidth = (k === " " ? "120px" : "34px");
        btn.style.borderRadius = "6px";
        btn.style.border = "1px solid #ddd";
        btn.style.background = "#f3f4f6";
        btn.style.cursor = "pointer";
        row.appendChild(btn);
      });
      virtualKeyboard.appendChild(row);
    };

    if (type === "letters") {
      makeRow(["q","w","e","r","t","y","u","i","o","p"]);
      makeRow(["a","s","d","f","g","h","j","k","l"]);
      makeRow(["z","x","c","v","b","n","m"]);
      makeRow([" "]); // spacebar row
    } else if (type === "numbers") {
      makeRow(["1","2","3","4","5","6","7","8","9","0"]);
      makeRow(["-","="," "]); // include common extras + space
    } else if (type === "symbols") {
      // a reasonable symbol set that covers typical punctuation in exercises
      makeRow([".",",","!","?",";",":"]);
      makeRow(["'","\"", "@", "#", "$", "%"]);
      makeRow(["&","*","(",")","/","-"]);
      makeRow([" "]); // space
    }

    // ensure keyboard click handler is attached (delegation below handles it)
  }

  // --- MOUSE MODE: similar to your original implementation, but uses normalized structures ---
  function loadMouseItem() {
    if (!mouseBoard) return;
    mouseBoard.innerHTML = "";
    if (currentCharIndex >= currentChars.length) {
      // finished topic
      feedbackEl.textContent = "‚úÖ Topic complete";
      if (currentTopicIndex < topics.length - 1) nextBtn.classList.remove("hidden");
      else restartBtn.classList.remove("hidden");
      return;
    }

    const word = String(currentChars[currentCharIndex] || "");
    targetChar.textContent = word.toLowerCase();
    feedbackEl.textContent = "";

    // create letter buttons for the word (shuffle)
    const letters = word.split("");
    const shuffled = letters.slice().sort(() => Math.random() - 0.5);

    shuffled.forEach(letter => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.textContent = String(letter).toLowerCase();
      btn.className = "mouse-letter";
      btn.style.padding = "6px 10px";
      btn.style.margin = "6px";
      btn.style.borderRadius = "8px";
      btn.style.background = "#e9d5ff";
      btn.style.cursor = "pointer";
      btn.addEventListener("click", () => handleMouseClick(letter, word));
      mouseBoard.appendChild(btn);
    });

    mouseBoard.dataset.word = word;
    mouseBoard.dataset.progress = "";
  }

  function handleMouseClick(letter, word) {
    let progress = mouseBoard.dataset.progress || "";
    const expected = word[progress.length];
    if (!expected) return;

    if (String(letter) === String(expected)) {
      progress += letter;
      mouseBoard.dataset.progress = progress;
      if (progress === word) {
        feedbackEl.textContent = "‚úÖ Correct!";
        feedbackEl.className = "text-green-600 font-semibold";
        currentCharIndex++;
        setTimeout(() => {
          loadMouseItem();
        }, 400);
      } else {
        // partial progress; do nothing special
      }
    } else {
      feedbackEl.textContent = "‚ùå Wrong letter!";
      feedbackEl.className = "text-red-600 font-semibold";
    }
  }

  // --- topic progression ---
  function nextTopic() {
    // hide next, then move to next topic in same term
    nextBtn.classList.add("hidden");
    currentTopicIndex++;
    if (currentTopicIndex < topics.length) {
      if (mode === "keyboard") loadTopicByIndex(currentTopicIndex);
      else loadTopicByIndex(currentTopicIndex);
    } else {
      // no more topics in term
      restartBtn.classList.remove("hidden");
      feedbackEl.textContent = "üéâ Term complete!";
    }
  }

  function restartTerm() {
    restartBtn.classList.add("hidden");
    currentTopicIndex = 0;
    loadTopicByIndex(currentTopicIndex);
  }

  // --- event listeners (delegated where possible) ---
  // Start keyboard mode
  startKeyboardBtn?.addEventListener("click", async () => {
    mode = "keyboard";
    // keep accordion unchanged; show practice area
    practiceArea?.classList.remove("hidden");
    virtualKeyboard?.classList.remove("hidden");
    mouseBoard?.classList.add("hidden");

    await loadClasses();
    if (!topics || topics.length === 0) {
      feedbackEl.textContent = "No topics found in classes.json (check structure).";
      return;
    }
    currentTopicIndex = 0;
    loadTopicByIndex(currentTopicIndex);
  });

  // Start mouse mode
  startMouseBtn?.addEventListener("click", async () => {
    mode = "mouse";
    practiceArea?.classList.remove("hidden");
    virtualKeyboard?.classList.add("hidden");
    mouseBoard?.classList.remove("hidden");

    await loadClasses();
    if (!topics || topics.length === 0) {
      feedbackEl.textContent = "No topics found in classes.json (check structure).";
      return;
    }
    currentTopicIndex = 0;
    loadTopicByIndex(currentTopicIndex);
  });

  // Virtual keyboard click (delegation)
  virtualKeyboard?.addEventListener("click", (ev) => {
    const el = ev.target.closest(".key, .vk-key");
    if (!el) return;
    const key = el.dataset.key;
    if (mode === "keyboard") checkKeyboardInput(key);
  });

  // Physical keyboard
  document.addEventListener("keydown", (ev) => {
    // ignore modifier-only keys
    if (mode !== "keyboard") return;
    if (!ev.key) return;
    // allow space, punctuation, numbers and letters
    const key = ev.key;
    // prevent default to avoid scrolling on space while typing inside practise.
    if (key === " ") ev.preventDefault();
    checkKeyboardInput(key);
  });

  // Next & Restart
  nextBtn?.addEventListener("click", nextTopic);
  restartBtn?.addEventListener("click", restartTerm);

  // --- small init ---
  // hide practice bits until user starts
  if (practiceArea) practiceArea.classList.add("hidden");
  if (virtualKeyboard) virtualKeyboard.classList.add("hidden");
  if (mouseBoard) mouseBoard.classList.add("hidden");
});
  
</script>




  <!-- Approved script --
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const container = document.getElementById("accordion");
  const today = new Date();
  const termUnlockDates = { 2: new Date("2026-01-04"), 3: new Date("2026-04-20") };

  // Modal elements
  const tutorModal = document.getElementById("tutorModal");
  const closeTutor = document.getElementById("closeTutor");
  const lessonTitle = document.getElementById("lessonTitle");
  const lessonText = document.getElementById("lessonText");
  const typingArea = document.getElementById("typingArea");
  const wpmEl = document.getElementById("wpm");
  const errorsEl = document.getElementById("errors");
  const accuracyEl = document.getElementById("accuracy");

  const btnPrev = document.getElementById("btnPrev");
  const btnNext = document.getElementById("btnNext");
  const btnRestart = document.getElementById("btnRestart");

  let sampleText = "";
  let startTime = null;
  let errors = 0;
  let currentTopics = [];
  let currentIndex = 0;

  // --- KEYBOARD LAYOUTS ---
  const keyIdMap = {
    "`": "backtick","1":"1","2":"2","3":"3","4":"4","5":"5","6":"6","7":"7","8":"8","9":"9","0":"0",
    "-":"minus","=":"equals","[":"bracket-left","]":"bracket-right","\\":"backslash",
    ";":"semicolon","'":"quote",",":"comma",".":"period","/":"slash"," ":"space",
    "enter":"enter","backspace":"backspace","tab":"tab","capslock":"capslock","shift":"shift",
    "control":"control","alt":"alt"
  };

  const layouts = {
    letters: [
      ["`","1","2","3","4","5","6","7","8","9","0","-","=","Backspace"],
      ["Tab","Q","W","E","R","T","Y","U","I","O","P","[","]","\\"],
      ["CapsLock","A","S","D","F","G","H","J","K","L",";","'","Enter"],
      ["Shift","Z","X","C","V","B","N","M",",",".","/","Shift"],
      ["Control","Alt","Space","Alt","Control"]
    ],
    specials: [
      ["!","@","#","$","%","^","&","*","(",")","-","="],
      ["[","]","{","}",";",":","'",'"',",",".","/","?"],
    ]
  };

  const keyboardContainer = document.getElementById("keyboard");

  function renderKeyboard(type="letters") {
    keyboardContainer.innerHTML = "";
    layouts[type].forEach(row => {
      const rowDiv = document.createElement("div");
      rowDiv.className = "flex justify-center mb-1 gap-1";
      row.forEach(k => {
        const keyBtn = document.createElement("div");
        keyBtn.className = "key px-3 py-2 rounded shadow text-center bg-gray-100 select-none";
        keyBtn.innerText = k;
        let idKey = k.toLowerCase();
        idKey = keyIdMap[idKey] || idKey.replace(/\s/g,'-');
        keyBtn.id = "key-" + idKey;
        rowDiv.appendChild(keyBtn);
      });
      keyboardContainer.appendChild(rowDiv);
    });
  }

  // --- RESET AND HIGHLIGHT KEYS ---
  function resetKeyboardHighlights() {
    document.querySelectorAll(".key").forEach(k => k.classList.remove("highlight"));
  }

  function highlightNextKey(nextChar) {
    resetKeyboardHighlights();
    if (!nextChar) return;

    // Check if alphabet
    const isAlpha = /^[a-zA-Z]$/.test(nextChar);
    renderKeyboard(isAlpha ? "letters" : "specials");

    // Handle uppercase
    const isUpper = nextChar >= 'A' && nextChar <= 'Z';
    const baseChar = isUpper ? nextChar.toLowerCase() : nextChar;

    const mapped = keyIdMap[baseChar] || baseChar;
    const keyEl = document.getElementById("key-" + mapped);
    if (keyEl) keyEl.classList.add("highlight");

    if (isUpper) {
      const shiftEl = document.getElementById("key-shift");
      if (shiftEl) shiftEl.classList.add("highlight");
    }
  }

  // Typing listener
  typingArea.addEventListener("input", () => {
    const typed = typingArea.value;
    lessonText.innerHTML = renderHighlightedText(sampleText, typed);
    updateStats(typed);
    highlightNextKey(sampleText[typed.length]);
  });

  // Flash key on physical press
  document.addEventListener("keydown", e => {
    if (tutorModal.classList.contains("hidden")) return;
    let key = e.key;
    const isUpper = key.length === 1 && key === key.toUpperCase() && /[A-Z]/.test(key);
    key = key.toLowerCase();
    key = keyIdMap[key] || key;
    const keyEl = document.getElementById("key-" + key);
    if (keyEl) {
      keyEl.classList.add("pressed");
      setTimeout(() => keyEl.classList.remove("pressed"), 150);
    }
    if (isUpper) {
      const shiftEl = document.getElementById("key-shift");
      if (shiftEl) {
        shiftEl.classList.add("pressed");
        setTimeout(() => shiftEl.classList.remove("pressed"), 150);
      }
    }
  });

  function renderHighlightedText(sample, typed) {
    let result = "";
    for (let i = 0; i < sample.length; i++) {
      if (i < typed.length) {
        result += sample[i] === typed[i]
          ? `<span class="text-green-600 underline">${sample[i]}</span>`
          : `<span class="text-red-600 underline">${sample[i]}</span>`;
      } else if (i === typed.length) {
        result += `<span class="current underline">${sample[i]}</span>`;
      } else {
        result += `<span class="text-gray-700">${sample[i]}</span>`;
      }
    }
    return result;
  }

  function updateStats(typed) {
    if (!startTime) startTime = new Date();
    errors = 0;
    for (let i = 0; i < typed.length; i++) {
      if (typed[i] !== sampleText[i]) errors++;
    }
    const elapsedMinutes = (new Date() - startTime) / 60000;
    const words = typed.trim().split(/\s+/).filter(Boolean).length;
    const wpm = elapsedMinutes > 0 ? Math.round(words / elapsedMinutes) : 0;
    const accuracy = typed.length > 0
      ? Math.max(0, Math.round(((typed.length - errors) / typed.length) * 100))
      : 100;
    wpmEl.textContent = wpm;
    errorsEl.textContent = errors;
    accuracyEl.textContent = accuracy;
  }

  function loadTopic(topic) {
    lessonTitle.textContent = topic.dataset.title;

    // Clean sample text: remove trailing commas, replace inside commas with spaces
    sampleText = topic.dataset.sample
      .replace(/,\s*$/g, "")
      .replace(/,\s*/g, " ");

    typingArea.value = "";
    lessonText.innerHTML = renderHighlightedText(sampleText, "");
    startTime = null;
    errors = 0;
    wpmEl.textContent = 0;
    errorsEl.textContent = 0;
    accuracyEl.textContent = 100;
    tutorModal.classList.remove("hidden");
    highlightNextKey(sampleText[0]);
  }

  // --- ACCORDION + JSON LOADING ---
  try {
    const res = await fetch("data/classes.json");
    const data = await res.json();
    const classes = Array.isArray(data) ? data : data.classes;

    classes.forEach(cls => {
      const card = document.createElement("div");
      card.className = "bg-white rounded-xl shadow-md overflow-hidden mb-4";

      const header = document.createElement("button");
      header.className = "accordion-header w-full flex justify-between items-center px-6 py-4 text-lg font-semibold bg-blue-100 hover:bg-blue-200 transition";
      header.innerHTML = `<span class="text-gray-900">${cls.name}</span><span class="text-gray-900">+</span>`;
      card.appendChild(header);

      const body = document.createElement("div");
      body.className = "accordion-body bg-gray-50";

      body.innerHTML = (cls.terms || []).map(term => {
        const termUnlocked = term.number === 1 || today >= termUnlockDates[term.number];
        return `
          <div class="mb-4">
            <h3 class="text-lg font-semibold text-blue-700 px-4 py-2">${term.title}</h3>
            ${(term.categories || []).map(cat => `
              <div class="ml-4 mb-2">
                <h4 class="text-md font-semibold text-purple-600 px-3 py-1">${cat.name}</h4>
                <ul class="space-y-2 pl-6">
                  ${(cat.topics || []).map(topic => {
                    const icon = cat.id === "mouse" ? "üñ±Ô∏è" : cat.id === "keyboard" ? "‚å®Ô∏è" : "üìñ";
                    return termUnlocked
                      ? `<li>
                          <button class="topicBtn block w-full text-left px-4 py-2 rounded-lg shadow text-gray-900 bg-white hover:shadow-md hover:bg-blue-50 transition flex items-center gap-2"
                            data-title="${topic.title}"
                            data-sample="${topic.sample}">
                            <span>${icon}</span> ${topic.title}
                          </button>
                        </li>`
                      : `<li><span class="block px-4 py-2 rounded-lg bg-gray-200 text-gray-500 cursor-not-allowed flex items-center gap-2">
                          <span>${icon}</span> ${topic.title} (Locked)</span></li>`;
                  }).join("")}
                </ul>
              </div>
            `).join("")}
          </div>`;
      }).join("");

      card.appendChild(body);

      // Accordion toggle
      header.addEventListener("click", () => {
        const isOpen = body.style.maxHeight && body.style.maxHeight !== "0px";
        container.querySelectorAll(".accordion-body").forEach(el => el.style.maxHeight = null);
        container.querySelectorAll(".accordion-header span:last-child").forEach(icon => icon.style.transform = "rotate(0deg)");
        if (!isOpen) {
          body.style.maxHeight = body.scrollHeight + "px";
          header.querySelector("span:last-child").style.transform = "rotate(45deg)";
        }
      });

      container.appendChild(card);
    });

    // --- TOPIC CLICK HANDLER ---
    container.addEventListener("click", e => {
      const btn = e.target.closest(".topicBtn");
      if (!btn) return;
      currentTopics = [...btn.closest("ul").querySelectorAll(".topicBtn")];
      currentIndex = currentTopics.indexOf(btn);
      loadTopic(btn);
    });

  } catch (err) {
    console.error("Error loading JSON:", err);
    container.innerHTML = '<p class="text-red-500">‚ö†Ô∏è Failed to load class data.</p>';
  }

  // --- NAVIGATION BUTTONS ---
  btnNext.addEventListener("click", () => {
    if (currentIndex < currentTopics.length - 1) {
      currentIndex++;
      loadTopic(currentTopics[currentIndex]);
    }
  });
  btnPrev.addEventListener("click", () => {
    if (currentIndex > 0) {
      currentIndex--;
      loadTopic(currentTopics[currentIndex]);
    }
  });
  btnRestart.addEventListener("click", () => {
    if (currentTopics.length > 0) {
      loadTopic(currentTopics[currentIndex]);
    }
  });

  closeTutor.addEventListener("click", () => {
    tutorModal.classList.add("hidden");
  });

  // Render default keyboard on load
  renderKeyboard("letters");

}); // DOMContentLoaded end
</script>

  <!-- main script --
  
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const container = document.getElementById("accordion");
  const today = new Date();
  const termUnlockDates = { 2: new Date("2026-01-04"), 3: new Date("2026-04-20") };

  // Modal elements
  const tutorModal = document.getElementById("tutorModal");
  const closeTutor = document.getElementById("closeTutor");
  const lessonTitle = document.getElementById("lessonTitle");
  const lessonText = document.getElementById("lessonText");
  const typingArea = document.getElementById("typingArea");
  const wpmEl = document.getElementById("wpm");
  const errorsEl = document.getElementById("errors");
  const accuracyEl = document.getElementById("accuracy");

  const btnPrev = document.getElementById("btnPrev");
  const btnNext = document.getElementById("btnNext");
  const btnRestart = document.getElementById("btnRestart");

  let sampleText = "";
  let startTime = null;
  let errors = 0;
  let currentTopics = [];
  let currentIndex = 0;

  // --- FULL COMPUTER KEYBOARD ---
  const keyIdMap = {
    "`": "backtick","1":"1","2":"2","3":"3","4":"4","5":"5","6":"6","7":"7","8":"8","9":"9","0":"0",
    "-":"minus","=":"equals","[":"bracket-left","]":"bracket-right","\\":"backslash",
    ";":"semicolon","'":"quote",",":"comma",".":"period","/":"slash"," ":"space",
    "enter":"enter","backspace":"backspace","tab":"tab","capslock":"capslock","shift":"shift",
    "control":"control","alt":"alt"
  };

  const keyboardRows = [
    ["`","1","2","3","4","5","6","7","8","9","0","-","=","Backspace"],
    ["Tab","Q","W","E","R","T","Y","U","I","O","P","[","]","\\"],
    ["CapsLock","A","S","D","F","G","H","J","K","L",";","'","Enter"],
    ["Shift","Z","X","C","V","B","N","M",",",".","/","Shift"],
    ["Control","Alt","Space","Alt","Control"]
  ];

  const keyboardContainer = document.getElementById("keyboard");
  keyboardContainer.innerHTML = "";
  keyboardRows.forEach(row => {
    const rowDiv = document.createElement("div");
    rowDiv.className = "flex justify-center mb-1 gap-1";
    row.forEach(k => {
      const keyBtn = document.createElement("div");
      keyBtn.className = "key px-3 py-2 rounded shadow text-center bg-gray-100 select-none";
      keyBtn.innerText = k;
      let idKey = k.toLowerCase();
      idKey = keyIdMap[idKey] || idKey.replace(/\s/g,'-');
      keyBtn.id = "key-" + idKey;
      rowDiv.appendChild(keyBtn);
    });
    keyboardContainer.appendChild(rowDiv);
  });

  // --- RESET AND HIGHLIGHT KEYS ---
  function resetKeyboardHighlights() {
    document.querySelectorAll(".key").forEach(k => k.classList.remove("highlight"));
  }

  function highlightNextKey(nextChar) {
    resetKeyboardHighlights();
    if (!nextChar) return;
    let char = nextChar.toLowerCase();
    char = keyIdMap[char] || char;
    const keyEl = document.getElementById("key-" + char);
    if (keyEl) keyEl.classList.add("highlight");
  }

  // Typing listener
  typingArea.addEventListener("input", () => {
    const typed = typingArea.value;
    lessonText.innerHTML = renderHighlightedText(sampleText, typed);
    updateStats(typed);
    highlightNextKey(sampleText[typed.length]);
  });

  // Flash key on physical press
  document.addEventListener("keydown", e => {
    if (tutorModal.classList.contains("hidden")) return;
    let key = e.key.toLowerCase();
    key = keyIdMap[key] || key;
    const keyEl = document.getElementById("key-" + key);
    if (keyEl) {
      keyEl.classList.add("pressed");
      setTimeout(() => keyEl.classList.remove("pressed"), 150);
    }
  });

  function renderHighlightedText(sample, typed) {
    let result = "";
    for (let i = 0; i < sample.length; i++) {
      if (i < typed.length) {
        result += sample[i] === typed[i]
          ? `<span class="text-green-600 underline">${sample[i]}</span>`
          : `<span class="text-red-600 underline">${sample[i]}</span>`;
      } else if (i === typed.length) {
        result += `<span class="current underline">${sample[i]}</span>`;
      } else {
        result += `<span class="text-gray-700">${sample[i]}</span>`;
      }
    }
    return result;
  }

  function updateStats(typed) {
    if (!startTime) startTime = new Date();
    errors = 0;
    for (let i = 0; i < typed.length; i++) {
      if (typed[i] !== sampleText[i]) errors++;
    }
    const elapsedMinutes = (new Date() - startTime) / 60000;
    const words = typed.trim().split(/\s+/).filter(Boolean).length;
    const wpm = elapsedMinutes > 0 ? Math.round(words / elapsedMinutes) : 0;
    const accuracy = typed.length > 0
      ? Math.max(0, Math.round(((typed.length - errors) / typed.length) * 100))
      : 100;
    wpmEl.textContent = wpm;
    errorsEl.textContent = errors;
    accuracyEl.textContent = accuracy;
  }

  function loadTopic(topic) {
    lessonTitle.textContent = topic.dataset.title;
    sampleText = topic.dataset.sample;
    typingArea.value = "";
    lessonText.innerHTML = renderHighlightedText(sampleText, "");
    startTime = null;
    errors = 0;
    wpmEl.textContent = 0;
    errorsEl.textContent = 0;
    accuracyEl.textContent = 100;
    tutorModal.classList.remove("hidden");
    highlightNextKey(sampleText[0]);
  }

// --- ACCORDION + JSON LOADING ---
  try {
    const res = await fetch("data/classes.json");
    const data = await res.json();
    const classes = Array.isArray(data) ? data : data.classes;

    classes.forEach(cls => {
      const card = document.createElement("div");
      card.className = "bg-white rounded-xl shadow-md overflow-hidden mb-4";

      const header = document.createElement("button");
      header.className = "accordion-header w-full flex justify-between items-center px-6 py-4 text-lg font-semibold bg-blue-100 hover:bg-blue-200 transition";
      header.innerHTML = `<span class="text-gray-900">${cls.name}</span><span class="text-gray-900">+</span>`;
      card.appendChild(header);

      const body = document.createElement("div");
      body.className = "accordion-body bg-gray-50";

      body.innerHTML = (cls.terms || []).map(term => {
        const termUnlocked = term.number === 1 || today >= termUnlockDates[term.number];
        return `
          <div class="mb-4">
            <h3 class="text-lg font-semibold text-blue-700 px-4 py-2">${term.title}</h3>
            ${(term.categories || []).map(cat => `
              <div class="ml-4 mb-2">
                <h4 class="text-md font-semibold text-purple-600 px-3 py-1">${cat.name}</h4>
                <ul class="space-y-2 pl-6">
                  ${(cat.topics || []).map(topic => {
                    const icon = cat.id === "mouse" ? "üñ±Ô∏è" : cat.id === "keyboard" ? "‚å®Ô∏è" : "üìñ";
                    return termUnlocked
                      ? `<li>
                          <button class="topicBtn block w-full text-left px-4 py-2 rounded-lg shadow text-gray-900 bg-white hover:shadow-md hover:bg-blue-50 transition flex items-center gap-2"
                            data-title="${topic.title}"
                            data-sample="${topic.sample}">
                            <span>${icon}</span> ${topic.title}
                          </button>
                        </li>`
                      : `<li><span class="block px-4 py-2 rounded-lg bg-gray-200 text-gray-500 cursor-not-allowed flex items-center gap-2">
                          <span>${icon}</span> ${topic.title} (Locked)</span></li>`;
                  }).join("")}
                </ul>
              </div>
            `).join("")}
          </div>`;
      }).join("");

      card.appendChild(body);

      // Accordion toggle
      header.addEventListener("click", () => {
        const isOpen = body.style.maxHeight && body.style.maxHeight !== "0px";
        container.querySelectorAll(".accordion-body").forEach(el => el.style.maxHeight = null);
        container.querySelectorAll(".accordion-header span:last-child").forEach(icon => icon.style.transform = "rotate(0deg)");
        if (!isOpen) {
          body.style.maxHeight = body.scrollHeight + "px";
          header.querySelector("span:last-child").style.transform = "rotate(45deg)";
        }
      });

      container.appendChild(card);
    });

    // --- TOPIC CLICK HANDLER ---
 container.addEventListener("click", e => {
      const btn = e.target.closest(".topicBtn");
      if (!btn) return;
      currentTopics = [...btn.closest("ul").querySelectorAll(".topicBtn")];
      currentIndex = currentTopics.indexOf(btn);
      loadTopic(btn);
    });

  } catch (err) {
    console.error("Error loading JSON:", err);
    container.innerHTML = '<p class="text-red-500">‚ö†Ô∏è Failed to load class data.</p>';
  }

  // --- NAVIGATION BUTTONS ---
  btnNext.addEventListener("click", () => {
    if (currentIndex < currentTopics.length - 1) {
      currentIndex++;
      loadTopic(currentTopics[currentIndex]);
    }
  });
  btnPrev.addEventListener("click", () => {
    if (currentIndex > 0) {
      currentIndex--;
      loadTopic(currentTopics[currentIndex]);
    }
  });
  btnRestart.addEventListener("click", () => {
    if (currentTopics.length > 0) {
      loadTopic(currentTopics[currentIndex]);
    }
  });

  closeTutor.addEventListener("click", () => {
    tutorModal.classList.add("hidden");
  });

}); // DOMContentLoaded end
</script>
  <!-- Footer -->
  <footer class="border-t bg-white/70 mt-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex flex-col md:flex-row justify-between gap-6">
      <div>
        <h4 class="font-bold">SmartKids Learning</h4>
        <p class="text-sm text-slate-600 max-w-xs">Teaching practical computer skills & coding to children across Nigeria and beyond.</p>
      </div>
      <div class="flex gap-6 items-start">
        <div>
          <h5 class="font-semibold">Contact</h5>
          <p class="text-sm text-slate-600">smartkidslearning.org</p>
        </div>
        <div>
          <h5 class="font-semibold">Follow</h5>
          <p class="text-sm text-slate-600">Twitter ‚Ä¢ Facebook ‚Ä¢ Instagram</p>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>
                          
